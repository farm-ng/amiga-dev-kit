<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/virtual_joystick/virtual-joystick-widget" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">01 - Widget | Farm-ng Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amiga.farm-ng.com/docs/tutorials/virtual_joystick/virtual-joystick-widget"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="01 - Widget | Farm-ng Developers"><meta data-rh="true" name="description" content="We will begin by defining a custom widget, the VirtualJoystickWidget,"><meta data-rh="true" property="og:description" content="We will begin by defining a custom widget, the VirtualJoystickWidget,"><link data-rh="true" rel="icon" href="/img/farm-ng_favicon.png"><link data-rh="true" rel="canonical" href="https://amiga.farm-ng.com/docs/tutorials/virtual_joystick/virtual-joystick-widget"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/tutorials/virtual_joystick/virtual-joystick-widget" hreflang="en"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/tutorials/virtual_joystick/virtual-joystick-widget" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EWY2LBZNZX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Farm-ng Developers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Farm-ng Developers Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-235819376-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Farm-ng Developers" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c29cff4a.css">
<script src="/assets/js/runtime~main.33e7c59f.js" defer="defer"></script>
<script src="/assets/js/main.625972fc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Join Farm-ng Discourse forum ðŸ¤– ðŸšœ <a target="_blank" rel="noopener noreferrer" href="https://discourse.farm-ng.com/"> Announcements, Q&A, share codes or ideas.</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Amiga Docs</b></a><a class="navbar__item navbar__link" href="/docs/amiga_quick_start/amiga-quick-start">User Manual</a><a class="navbar__item navbar__link" href="/docs/concepts/">Developers</a><a class="navbar__item navbar__link" href="/docs/hardware-tools/recommended-tools">Reference</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/examples/examples-index">Examples</a><a href="https://discourse.farm-ng.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discourse</a><a class="navbar__item navbar__link" href="/docs/support/">Support</a><a href="https://farm-ng.com/products/la-maquina-amiga" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Shop</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCczyy8tyLbqxjtLE1_8YW3w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="Youtube"></a><a href="https://github.com/farm-ng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/examples/examples-index">Examples Index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/hello_main_loop/">Microcontroller Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/events_recorder/">Brain Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/introduction/tutorial-introduction">Kivy App Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/introduction/tutorial-introduction">00 -Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/camera_streamer/camera-streamer-overview">01 - Camera Streamer Example</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/tutorials/virtual_joystick/virtual-joystick-overview">02 - Virtual Joystick Example</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/virtual_joystick/virtual-joystick-overview">00 - Virtual Joystick Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/virtual_joystick/virtual-joystick-widget">01 - Widget</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/virtual_joystick/device-streams">02 - Main Implementation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/virtual_joystick/further-exercises">03 - Further Exercises</a></li></ul></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kivy App Examples</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">02 - Virtual Joystick Example</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">01 - Widget</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Building Virtual Joystick Widget</h1>
<p>We will begin by defining a custom widget, the <code>VirtualJoystickWidget</code>,
by following the kivy API to add widgets to our application!</p>
<p>This widget will be used to drive the robot by moving the virtual
joystick on the Brain screen.
The driving behavior is modelled after the behavior of driving
with the joystick on the pendant.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you ever feel lost, please refer to the <a href="https://github.com/farm-ng/virtual-joystick-v2/tree/main" target="_blank" rel="noopener noreferrer"><code>Virtual-Joystick Repository</code></a>.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="virtual-joystick-app-structure">Virtual Joystick App Structure<a href="#virtual-joystick-app-structure" class="hash-link" aria-label="Direct link to Virtual Joystick App Structure" title="Direct link to Virtual Joystick App Structure">â€‹</a></h2>
<p>In this tutorial, it is expected that you are familiear with the previous camera-streamer example.</p>
<p>We will be adding files to libs/ to build our custom kivy widget. By the end of this tutorial,
your file tree should look like this.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Virtual-Joystick-v2/  # Root level of the project.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ libs/ # Contains private libraries.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â”œâ”€â”€ amiga_packages/ # placeholder for other template packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â””â”€â”€ virtual_joystick/ # virtual joystick package we&#x27;ll build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       â”œâ”€â”€ res/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       |   â””â”€â”€ virtual_joystick.kv # kivy virtual joystick frontend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       â”œâ”€â”€ joystick.py # kivy virtual joystick backend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|       â””â”€â”€ utils.py # helper functions for joystick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ src/ # Contains all code needed to run the main gui application.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â”œâ”€â”€ assets/  # Contains files needed to run the application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   â””â”€â”€ app_logo.png  # static images or images for buttons.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â”œâ”€â”€ res/  # Contains the layout files and UI strings.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |   â””â”€â”€ main.kv  # main ui layout in Kivy languague</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â””â”€â”€ main.py  # Is the main entry point for the gui application.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ test/  # Contains code for test of the private libs.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   â””â”€â”€ test_dummy.py  # sets of unit test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ install.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    # The script to install the app on the brain.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ uninstall.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    # The script to uninstall the app from the brain.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ manifest.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    # The file containing the metadata of the app to register it on the brain.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ entry.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|    # The script to setup the project, create a virtual env. and install dependencies.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ setup.cfg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # The file containing the metadata of the package, including the name, versioning,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # etc. Learn more here: https://setuptools.pypa.io/en/latest/userguide/declarative_config.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="building-the-widget-in-libsvirtual_joystick">Building the widget in libs/virtual_joystick<a href="#building-the-widget-in-libsvirtual_joystick" class="hash-link" aria-label="Direct link to Building the widget in libs/virtual_joystick" title="Direct link to Building the widget in libs/virtual_joystick">â€‹</a></h2>
<p>By the end of this section, our virtual_joystick will look something like this:</p>
<div align="center"><p><img loading="lazy" src="https://github.com/farm-ng/amiga-dev-kit/assets/53889589/e574c53a-39bf-4784-b010-8a0e24e3dfd9" alt="virtualJoystick" class="img_ev3q"></p></div>
<p>We will need to add a few files in order to get there. All of the files
for the joystick widget will be stored in libs/virtual_joystick. This will make
it easiest to organize our project. We recommend you do the same for any and all
custom widgets you hope to add to your custom application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-file-virtual_joystickresvirtual_joystickkv">New File: virtual_joystick/res/virtual_joystick.kv<a href="#new-file-virtual_joystickresvirtual_joystickkv" class="hash-link" aria-label="Direct link to New File: virtual_joystick/res/virtual_joystick.kv" title="Direct link to New File: virtual_joystick/res/virtual_joystick.kv">â€‹</a></h2>
<p>Within the folder libs/virtual_joystick/res, create a file called virtual_joystick.kv
and add the following content.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="virtual_joystickkv">virtual_joystick.kv<a href="#virtual_joystickkv" class="hash-link" aria-label="Direct link to virtual_joystick.kv" title="Direct link to virtual_joystick.kv">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;VirtualJoystickWidget&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joystick_diameter: 200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joystick_position_x: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joystick_position_y: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    canvas:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Color:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rgba: 0.2, 0.2, 0.2, 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ellipse:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            id: background_ellipse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pos: root.center_x - root.width // 2, root.center_y - root.height // 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            size: root.width, root.height</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Color:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            rgba: 1.0, 1.0, 0.0, 1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ellipse:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            id: joystick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pos: root.joystick_position_x, root.joystick_position_y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            size: root.joystick_diameter, root.joystick_diameter</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can think of this similar to a class, where there are a few instance variables
assigned to each instacnce of the <code>&lt;VirtualJoystickWidget&gt;</code>. These are, diameter, position_x
and position_y. These are variables we will access to draw our joystick but also querry
its position on the screen.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-file-virtual_joystickutilspy">New File: virtual_joystick/utils.py<a href="#new-file-virtual_joystickutilspy" class="hash-link" aria-label="Direct link to New File: virtual_joystick/utils.py" title="Direct link to New File: virtual_joystick/utils.py">â€‹</a></h2>
<p>Writing modules is avery useful tool in python so we decided to add one to this example.
In this example, a module is a python file that contains methods. They are used for code
readbility and making programs modular.</p>
<p>Once you have created the file utils.py, copy the following code:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="utilspy">utils.py<a href="#utilspy" class="hash-link" aria-label="Direct link to utils.py" title="Direct link to utils.py">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Vec2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Simple container for keeping joystick coords in x &amp; y terms.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Defaults to a centered joystick (0,0). Clips values to range [-1.0, 1.0], as with the Amiga joystick.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, x: float = 0.0, y: float = 0.0) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.x: float = min(max(-1.0, x), 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.y: float = min(max(-1.0, y), 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __str__(self) -&gt; str:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return f&quot;({self.x:0.2f}, {self.y:0.2f})&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates a class called Vec2. What this allows us to is make a Vec2 object in the future.
It will make more sense as the tutorial continues. The class Vec2() will store the coordinates
of joystick bounded between -1 and 1.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-file-virtual_joystickvirtual_joystickpy">New File: virtual_joystick/virtual_joystick.py<a href="#new-file-virtual_joystickvirtual_joystickpy" class="hash-link" aria-label="Direct link to New File: virtual_joystick/virtual_joystick.py" title="Direct link to New File: virtual_joystick/virtual_joystick.py">â€‹</a></h2>
<p>Now that our kivy string is defined, we can define the features of our widget in python.
These methods will allow us from our main app to read the state of our joystick.
This section includes all the sequential blocks of code to build this file. Feel free
to refer to the repository if you get lost in the chaos.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="imports">Imports<a href="#imports" class="hash-link" aria-label="Direct link to Imports" title="Direct link to Imports">â€‹</a></h3>
<p>Similar to the previous examples, we will need some external libraries. The top of this
file should look like this:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from math import sqrt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Tuple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from virtual_joystick.utils import Vec2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Must come before kivy imports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os.environ[&quot;KIVY_NO_ARGS&quot;] = &quot;1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.clock import Clock  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.input.providers.mouse import MouseMotionEvent  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.lang.builder import Builder  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.uix.widget import Widget  # noqa: E402</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We are importing a method called Vec2 from virtual_joystick.utils. This is a good introduction
to building modules in python.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from virtual_joystick.utils import Vec2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This means, from within the folder, virtual_joystick, import the utils file. From utils, import
the class Vec2. This will allow us to create Vec2 objects from within virtual_joystick.py.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-class-virtualjoystickwidget">New Class: VirtualJoystickWidget<a href="#new-class-virtualjoystickwidget" class="hash-link" aria-label="Direct link to New Class: VirtualJoystickWidget" title="Direct link to New Class: VirtualJoystickWidget">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class VirtualJoystickWidget(Widget):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, **kwargs) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(VirtualJoystickWidget, self).__init__(**kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_pose: Vec2 = Vec2()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Schedule the drawing of the joystick at 30 hz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Clock.schedule_interval(self.draw_joystick, 1 / 30)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Build the .kv file for this VirtualJoystickWidget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # This is so it is included when your app imports the VirtualJoystickWidget</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Builder.load_file(os.path.join(os.path.dirname(__file__), &quot;res/joystick.kv&quot;))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>There is a lot going on in this initialization. But most simply, it sets up the superclass
of this Widget Class. Next, we create an instance of Vec2 called self.joystick_pose. This
will store the position of our joystick in (x,y) coordinates.</p>
<p>Clock, is the kivy eventloop. This is used to schedule updates of the user interface at 30 Hz.</p>
<p>Finally, we use the Builder module from kivy to build our joystick widget.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-kivy-method-on_touch_down">Update Kivy Method: on_touch_down()<a href="#update-kivy-method-on_touch_down" class="hash-link" aria-label="Direct link to Update Kivy Method: on_touch_down()" title="Direct link to Update Kivy Method: on_touch_down()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def on_touch_down(self, touch: MouseMotionEvent) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Overwrite kivy method that handles initial press with mouse click or touchscreen.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NOTE: This is called regardless of whether this is the touched widget.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Check if touch is in this widget using kivy ``collide_point`` method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not self.collide_point(*touch.pos):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.update_joystick_pose(touch)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This method takes a touch event generated by kivy every time the screen is pressed,
the coordinates are passed to self.update_joystick_pose() method.</p>
<p>More info can be found here:
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_down" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_down()</code></strong></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-kivy-method-on_touch_move">Update Kivy Method: on_touch_move()<a href="#update-kivy-method-on_touch_move" class="hash-link" aria-label="Direct link to Update Kivy Method: on_touch_move()" title="Direct link to Update Kivy Method: on_touch_move()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def on_touch_move(self, touch: MouseMotionEvent) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Overwrite kivy method that handles when press is held and dragged with mouse click or touchscreen.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NOTE: This is called regardless of whether this is the touched widget.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Check if touch is in this widget using kivy ``collide_point`` method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if not self.collide_point(*touch.pos):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.update_joystick_pose(touch)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can see that this method performs the same operation as
on_touch_down(), however it is used to handle when
a touch is held.</p>
<p>More info can be found here:
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_move" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_move()</code></strong></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-kivy-method-on_touch_up">Update Kivy Method: on_touch_up()<a href="#update-kivy-method-on_touch_up" class="hash-link" aria-label="Direct link to Update Kivy Method: on_touch_up()" title="Direct link to Update Kivy Method: on_touch_up()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def on_touch_up(self, touch: MouseMotionEvent) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Overwrite kivy method that handles release of press with mouse click or touchscreen.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        NOTE: This is called regardless of whether this is the touched widget.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Reset joystick pose, regardless of where touch_up occurs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_pose = Vec2()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This method resets the position of the joystick when the screen is no longer being depressed.</p>
<p>More info can be found here:
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_up" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_up()</code></strong></a></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-method-update_joystick_pose">New Method: update_joystick_pose()<a href="#new-method-update_joystick_pose" class="hash-link" aria-label="Direct link to New Method: update_joystick_pose()" title="Direct link to New Method: update_joystick_pose()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def update_joystick_pose(self, touch: MouseMotionEvent) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        assert self.collide_point(*touch.pos), &quot;Only pass touches &quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        res: Tuple[float, float] = self.relative_cord_in_widget(touch)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Clip to unit circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        div: float = max(1.0, sqrt(res[0] ** 2 + res[1] ** 2))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_pose = Vec2(x=res[0] / div, y=res[1] / div)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When you press, hold and move your finger, this method is responsible for
taking that motion and converting it to a Vec2() object to let kivy know where to
move the yellow icon. div is used to normalize the motion to that on the unit circle.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-method-relative_cord_in_widget">New Method: relative_cord_in_widget()<a href="#new-method-relative_cord_in_widget" class="hash-link" aria-label="Direct link to New Method: relative_cord_in_widget()" title="Direct link to New Method: relative_cord_in_widget()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def relative_cord_in_widget(self, touch: MouseMotionEvent) -&gt; Tuple[float, float]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Returns the coordinates of the touch on the scale IFF it occurs within the bounds of the widget.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Range to put the values on</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scale: Tuple[float, float] = (-1.0, 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # Map coord onto scale range</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scale[0] + (touch.x - self.pos[0]) * (scale[1] - scale[0]) / (self.width),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            scale[0] + (touch.y - self.pos[1]) * (scale[1] - scale[0]) / (self.height),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This method is used to ensure that the joystick only moves when TouchEvents have occurred
within the bounds of the widget.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="new-method-draw_joystick">New Method: draw_joystick()<a href="#new-method-draw_joystick" class="hash-link" aria-label="Direct link to New Method: draw_joystick()" title="Direct link to New Method: draw_joystick()">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def draw_joystick(self, dt: float = 0.0):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Update the drawn pose of the joystick, in pixel coords.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_position_x = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.center_x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            + 0.5 * self.joystick_pose.x * (self.width - self.joystick_diameter)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - self.joystick_diameter // 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_position_y = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.center_y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            + 0.5 * self.joystick_pose.y * (self.height - self.joystick_diameter)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            - self.joystick_diameter // 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The final function we have is draw_joystick(). This method is called by the Clock at
a frequency of 30Hz. This updates the coordinates of the yellow circle in the virtual joysick.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-information">More Information<a href="#more-information" class="hash-link" aria-label="Direct link to More Information" title="Direct link to More Information">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="builder">Builder<a href="#builder" class="hash-link" aria-label="Direct link to Builder" title="Direct link to Builder">â€‹</a></h3>
<p>By building the <code>.kv</code> definition of the <code>VirtualJoystickWidget</code>
in the Python constructor,
the widget can be imported just like a kivy API widget.
That means you can import it into your Python definition of your
<code>App</code> (i.e., <code>main.py</code>), and reference it both there and in your
kivy app definition (i.e., <code>main.kv</code>)</p>
<p>Explore
<a href="https://kivy.org/doc/stable/api-kivy.lang.builder.html" target="_blank" rel="noopener noreferrer"><strong>kivy <code>Builder</code></strong></a>
for more details.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="kivy-clock">kivy <code>Clock</code><a href="#kivy-clock" class="hash-link" aria-label="Direct link to kivy-clock" title="Direct link to kivy-clock">â€‹</a></h3>
<p>We schedule regular updates to the linked variables containing
the pose of the drawn joystick using the <a href="https://kivy.org/doc/stable/api-kivy.clock.html" target="_blank" rel="noopener noreferrer"><strong>kivy Clock</strong></a>.
kivy provides multiple options for scheduling tasks, which you
can explore in their API.</p>
<p>Updating these linked values will cause the drawn Widget to
automatically update.
You could alternatively update these values as they are
calculated in the touch handling methods if you don&#x27;t want to use
the kivy <code>Clock</code>.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Do not schedule long running, blocking tasks with the kivy clock
or you will freeze the app while the task executes.
The kivy clock (which runs on the main loop) should only be used
to schedule very quick actions.</p><p>Blocking tasks should be scheduled as an <code>asyncio</code> task!</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="touch-handling">Touch handling<a href="#touch-handling" class="hash-link" aria-label="Direct link to Touch handling" title="Direct link to Touch handling">â€‹</a></h3>
<p>The <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_down" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_down()</code></strong></a>,
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_move" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_move()</code></strong></a>,
and
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.on_touch_up" target="_blank" rel="noopener noreferrer"><strong><code>on_touch_up()</code></strong></a>
calls are triggered for all <code>Widget</code>s within a kivy <code>App</code> whenever there is a touch interaction (by default).</p>
<p>We overwrite the default behavior of these methods to move the
pose of the joystick whenever we touch and/or move within the
<code>VirtualJoystickWidget</code>,
and recenter the joystick upon release.</p>
<p>From the <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html" target="_blank" rel="noopener noreferrer"><strong>kivy <code>Widget</code> class docs</strong></a>,
which all widgets inherit from:</p>
<blockquote>
<p><code>on_touch_down()</code>, <code>on_touch_move()</code>, <code>on_touch_up()</code> donâ€™t do
any sort of collisions.
If you want to know if the touch is inside your widget, use
<code>collide_point()</code>.</p>
</blockquote>
<p>So we filter <code>on_touch_down()</code> &amp; <code>on_touch_move()</code> with
<a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.collide_point" target="_blank" rel="noopener noreferrer"><strong><code>collide_point()</code></strong></a>
to only perform our custom behavior when the touch occurred within our <code>VirtualJoystickWidget</code>.</p>
<p>Because we want to recenter the joystick regardless of which
widget the <code>touch_up</code> occurred in, we do not filter
<code>on_touch_up()</code> with <code>collide_point()</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/tutorials/virtual_joystick/01_virtual_joystick_widget.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/virtual_joystick/virtual-joystick-overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">00 - Virtual Joystick Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/virtual_joystick/device-streams"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">02 - Main Implementation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#virtual-joystick-app-structure" class="table-of-contents__link toc-highlight">Virtual Joystick App Structure</a></li><li><a href="#building-the-widget-in-libsvirtual_joystick" class="table-of-contents__link toc-highlight">Building the widget in libs/virtual_joystick</a></li><li><a href="#new-file-virtual_joystickresvirtual_joystickkv" class="table-of-contents__link toc-highlight">New File: virtual_joystick/res/virtual_joystick.kv</a><ul><li><a href="#virtual_joystickkv" class="table-of-contents__link toc-highlight">virtual_joystick.kv</a></li></ul></li><li><a href="#new-file-virtual_joystickutilspy" class="table-of-contents__link toc-highlight">New File: virtual_joystick/utils.py</a><ul><li><a href="#utilspy" class="table-of-contents__link toc-highlight">utils.py</a></li></ul></li><li><a href="#new-file-virtual_joystickvirtual_joystickpy" class="table-of-contents__link toc-highlight">New File: virtual_joystick/virtual_joystick.py</a><ul><li><a href="#imports" class="table-of-contents__link toc-highlight">Imports</a></li><li><a href="#new-class-virtualjoystickwidget" class="table-of-contents__link toc-highlight">New Class: VirtualJoystickWidget</a></li><li><a href="#update-kivy-method-on_touch_down" class="table-of-contents__link toc-highlight">Update Kivy Method: on_touch_down()</a></li><li><a href="#update-kivy-method-on_touch_move" class="table-of-contents__link toc-highlight">Update Kivy Method: on_touch_move()</a></li><li><a href="#update-kivy-method-on_touch_up" class="table-of-contents__link toc-highlight">Update Kivy Method: on_touch_up()</a></li><li><a href="#new-method-update_joystick_pose" class="table-of-contents__link toc-highlight">New Method: update_joystick_pose()</a></li><li><a href="#new-method-relative_cord_in_widget" class="table-of-contents__link toc-highlight">New Method: relative_cord_in_widget()</a></li><li><a href="#new-method-draw_joystick" class="table-of-contents__link toc-highlight">New Method: draw_joystick()</a></li></ul></li><li><a href="#more-information" class="table-of-contents__link toc-highlight">More Information</a><ul><li><a href="#builder" class="table-of-contents__link toc-highlight">Builder</a></li><li><a href="#kivy-clock" class="table-of-contents__link toc-highlight">kivy <code>Clock</code></a></li><li><a href="#touch-handling" class="table-of-contents__link toc-highlight">Touch handling</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/contribute-website">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.farm-ng.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="left">Discourse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Farm-ng</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-ng/farm-ng-amiga" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-amiga<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://farm-ng.github.io/farm-ng-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-ros-bridge-v1" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-amiga-ros-bridge<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Sister projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kornia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kornia<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/stevenlovegrove/Pangolin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pangolin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://strasdat.github.io/Sophus/latest/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sophus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-ng" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Farm-ng, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>