<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/camera_streamer/camera-stream" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">02 - Python Implementation | Farm-ng Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amiga.farm-ng.com/docs/tutorials/camera_streamer/camera-stream"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="02 - Python Implementation | Farm-ng Developers"><meta data-rh="true" name="description" content="Similar to the last tutorial, this will give a break down of the most important features of the"><meta data-rh="true" property="og:description" content="Similar to the last tutorial, this will give a break down of the most important features of the"><link data-rh="true" rel="icon" href="/img/farm-ng_favicon.png"><link data-rh="true" rel="canonical" href="https://amiga.farm-ng.com/docs/tutorials/camera_streamer/camera-stream"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/tutorials/camera_streamer/camera-stream" hreflang="en"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/tutorials/camera_streamer/camera-stream" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EWY2LBZNZX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Farm-ng Developers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Farm-ng Developers Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-235819376-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Farm-ng Developers" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c29cff4a.css">
<script src="/assets/js/runtime~main.fa5d50ea.js" defer="defer"></script>
<script src="/assets/js/main.445ddadb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Join Farm-ng Discourse forum ðŸ¤– ðŸšœ <a target="_blank" rel="noopener noreferrer" href="https://discourse.farm-ng.com/"> Announcements, Q&A, share codes or ideas.</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Amiga Docs</b></a><a class="navbar__item navbar__link" href="/docs/amiga_quick_start/amiga-quick-start">User Manual</a><a class="navbar__item navbar__link" href="/docs/concepts/">Developers</a><a class="navbar__item navbar__link" href="/docs/hardware-tools/recommended-tools">Reference</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/examples/examples-index">Examples</a><a href="https://discourse.farm-ng.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discourse</a><a class="navbar__item navbar__link" href="/docs/support/">Support</a><a href="https://farm-ng.com/products/la-maquina-amiga" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Shop</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCczyy8tyLbqxjtLE1_8YW3w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="Youtube"></a><a href="https://github.com/farm-ng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/examples/examples-index">Examples Index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/hello_main_loop/">Microcontroller Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/events_recorder/">Brain Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/tutorials/introduction/tutorial-introduction">Kivy App Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/introduction/tutorial-introduction">00 -Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/tutorials/camera_streamer/camera-streamer-overview">01 - Camera Streamer Example</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/camera_streamer/camera-streamer-overview">00 - Camera Streamer Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tutorials/camera_streamer/kivy-definition">01 - Kivy Definition</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/camera_streamer/camera-stream">02 - Python Implementation</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/tutorials/virtual_joystick/virtual-joystick-overview">02 - Virtual Joystick Example</a></div></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kivy App Examples</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">01 - Camera Streamer Example</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">02 - Python Implementation</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Python Implementation</h1>
<p>Similar to the last tutorial, this will give a break down of the most important features of the
<a href="https://github.com/farm-ng/camera-streamer" target="_blank" rel="noopener noreferrer"><strong>camera-streamer</strong></a> repository</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>The Python implementation of the
<a href="https://github.com/farm-ng/camera-streamer" target="_blank" rel="noopener noreferrer"><strong>camera-streamer</strong></a>
app can be found at
<a href="https://github.com/farm-ng/camera-streamer/blob/main/src/main.py" target="_blank" rel="noopener noreferrer"><strong><code>src/main.py</code></strong></a>.
You should open that file for reference as you follow along.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rename-classes">Rename Classes<a href="#rename-classes" class="hash-link" aria-label="Direct link to Rename Classes" title="Direct link to Rename Classes">â€‹</a></h2>
<p>In the <a href="https://github.com/farm-ng/camera-streamer" target="_blank" rel="noopener noreferrer"><strong>camera-streamer</strong></a> repository,
we have renamed some
keywords. Begin by navigating to <code>src/main.py</code> in your app and open it.
There are 2 places to change the templated name:</p>
<div class="language-Python language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Rename the class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class CameraApp(App):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Run with the new class name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop.run_until_complete(CameraApp().app_func())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">except asyncio.CancelledError:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-imports">Update Imports<a href="#update-imports" class="hash-link" aria-label="Direct link to Update Imports" title="Direct link to Update Imports">â€‹</a></h2>
<p>This app is app will be the first real taste of the Amiga SDK.
We will now need to import farm-ng libraries to access the oak
camera streams.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from __future__ import annotations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import argparse</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import asyncio</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import logging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import os</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from pathlib import Path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Literal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_client import EventClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import EventServiceConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import EventServiceConfigList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import SubscribeRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.events_file_reader import payload_to_protobuf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.events_file_reader import proto_from_json_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.uri_pb2 import Uri</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from turbojpeg import TurboJPEG</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">os.environ[&quot;KIVY_NO_ARGS&quot;] = &quot;1&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.config import Config  # noreorder # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;graphics&quot;, &quot;resizable&quot;, False)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;graphics&quot;, &quot;width&quot;, &quot;1280&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;graphics&quot;, &quot;height&quot;, &quot;800&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;graphics&quot;, &quot;fullscreen&quot;, &quot;false&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;input&quot;, &quot;mouse&quot;, &quot;mouse,disable_on_activity&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Config.set(&quot;kivy&quot;, &quot;keyboard_mode&quot;, &quot;systemanddock&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.app import App  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.lang.builder import Builder  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.graphics.texture import Texture  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">logger = logging.getLogger(&quot;amiga.apps.camera&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can go line-by-line, however, we recommend that imports above
class CameraApp(App) looks like the list above.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-cameraapp">Update: CameraApp()<a href="#update-cameraapp" class="hash-link" aria-label="Direct link to Update: CameraApp()" title="Direct link to Update: CameraApp()">â€‹</a></h2>
<p>The camera app will generally follow the same format as the template tic-toc app.
However, will also subscribe to a farm-ng service, in the case of this application,
it will be the oak camera service.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class CameraApp(App):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Base class for the main Kivy app.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    STREAM_NAMES = [&quot;rgb&quot;, &quot;disparity&quot;, &quot;left&quot;, &quot;right&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, service_config: EventServiceConfig) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super().__init__()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.service_config = service_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.image_decoder = TurboJPEG()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.async_tasks: list[asyncio.Task] = []</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The EventServiceConfig contains the custom configuration used to
specify which specific services your custom application
will need to access. It will be stored in the variable <strong><code>self.service_config</code></strong></p>
<p><strong><code>image_decoder</code></strong> is responsible for taking the raw bit
stream from the oak service and packing them to
make python interpretable image frames.
We will use <code>TurboJPEG</code> as the image decoder (it is much faster
than kivy&#x27;s default image decoder).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-on_exit_btnself">Update: on_exit_btn(self)<a href="#update-on_exit_btnself" class="hash-link" aria-label="Direct link to Update: on_exit_btn(self)" title="Direct link to Update: on_exit_btn(self)">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    def on_exit_btn(self) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Kills the running kivy application.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for task in self.tasks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            task.cancel()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        App.get_running_app().stop()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This method is similar to the <a href="https://github.com/farm-ng/amiga-app-template-kivy" target="_blank" rel="noopener noreferrer"><strong><code>amiga-app-template-kivy</code></strong></a>
however, this time we also need to cancel the async tasks that are running.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-app_funcself">Update: app_func(self)<a href="#update-app_funcself" class="hash-link" aria-label="Direct link to Update: app_func(self)" title="Direct link to Update: app_func(self)">â€‹</a></h3>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    async def app_func(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        config_list = proto_from_json_file(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.service_config, EventServiceConfigList()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        oak0_client: EventClient | None = None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for config in config_list.configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if config.name == &quot;oak0&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                oak0_client = EventClient(config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if None in [oak0_client]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            raise RuntimeError(f&quot;No {config} service config in {self.service_config}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # stream camera frames</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.tasks: list[asyncio.Task] = [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            asyncio.create_task(self.stream_camera(oak0_client, view_name))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for view_name in self.STREAM_NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return await asyncio.gather(run_wrapper(), *self.tasks)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>More information can be found here:
<a href="https://github.com/farm-ng/farm-ng-core/blob/main/py/farm_ng/core/event_client.py" target="_blank" rel="noopener noreferrer"><strong><code>farm-ng-core</code></strong></a>
and the <a href="/docs/examples/camera_client/"><strong><code>Oak Camera Client</code></strong></a> example.</p>
<p>Within this repository and example, you can see how <strong><code>config_list</code></strong> and <strong><code>oak0_client</code></strong> are made.</p>
<p>Finally, once the oak0_client is made, it can be used to subscribe to the camera streams.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-method-stream_camera">New Method: stream_camera()<a href="#new-method-stream_camera" class="hash-link" aria-label="Direct link to New Method: stream_camera()" title="Direct link to New Method: stream_camera()">â€‹</a></h2>
<p>Now, add the function stream_camera. The loop for view_name in STREAM_NAMES
makes four instances of the stream_camera method.
We make all four instances as opposed to only one because rather
than changing the async tasks, we can conditionally display
the image streams.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async def stream_camera(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        oak_client: EventClient,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        view_name: Literal[&quot;rgb&quot;, &quot;disparity&quot;, &quot;left&quot;, &quot;right&quot;] = &quot;rgb&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;&quot;&quot;Subscribes to the camera service and populates the tabbed panel with all 4 image streams.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while self.root is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await asyncio.sleep(0.01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rate = oak_client.config.subscriptions[0].every_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        async for event, payload in oak_client.subscribe(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubscribeRequest(uri=Uri(path=f&quot;/{view_name}&quot;), every_n=rate),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            decode=False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            self.view_name = self.root.ids[&quot;tab_root&quot;].current_tab.text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if view_name == self.view_name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                message = payload_to_protobuf(event, payload)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    img = self.image_decoder.decode(message.image_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    logger.exception(f&quot;Error decoding image: {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                # create the opengl texture and set it to the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                texture = Texture.create(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    size=(img.shape[1], img.shape[0]), icolorfmt=&quot;bgr&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                texture.flip_vertical()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                texture.blit_buffer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    bytes(img.data),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    colorfmt=&quot;bgr&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    bufferfmt=&quot;ubyte&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    mipmap_generation=False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                self.root.ids[view_name].texture = texture</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="event-client">Event Client<a href="#event-client" class="hash-link" aria-label="Direct link to Event Client" title="Direct link to Event Client">â€‹</a></h3>
<p>The client-service framework used here is vital to communicate with the Amiga.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async for _, message in EventClient(self.service_config).subscribe(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    SubscribeRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uri=Uri(path=f&quot;/{[view_name]}&quot;), every_n=self.stream_every_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    decode=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">):</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The EventClient is listening to all of the messages being sent
by each of the services on the Amiga.</p>
<p>This class is the &quot;on-ramp&quot; used to access the Amigas communication
highway. All the other vehicles on the highway are messages from the
other services. The, oaks, canbus, trackfollower, etc... can all be
accessed from this EventClient.</p>
<p>It can also be used for subsrbibing to all other services that might be used
by your custom application.</p>
<p>More details on the .subscribe() method can be found here:
<a href="https://github.com/farm-ng/farm-ng-core/blob/main/py/farm_ng/core/event_client.py" target="_blank" rel="noopener noreferrer"><strong>event_client.py</strong></a></p>
<p>SubscribeRequest accepts an uri (message name) and a relative frequency (every_n). This
is considered a relative frequency because the oak service operates at
10hz while the canbus operates at 50hz.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="decode-and-display">Decode and display<a href="#decode-and-display" class="hash-link" aria-label="Direct link to Decode and display" title="Direct link to Decode and display">â€‹</a></h3>
<p>Finally, we can decode and display the images received from the
stream.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  # create the opengl texture and set it to the image</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  texture = Texture.create(size=(img.shape[1], img.shape[0]), icolorfmt=&quot;bgr&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  texture.flip_vertical()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  texture.blit_buffer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bytes(img.data),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      colorfmt=&quot;bgr&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      bufferfmt=&quot;ubyte&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mipmap_generation=False,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  self.root.ids[view_name].texture = texture</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For each of the image streams, we update the <code>Image</code> widget
<code>Texture</code> in the <code>TabbedPanel</code> with the corresponding decoded
image.
The <code>Image</code> widgets in the <code>TabbedPanel</code> accessed by their kivy
id.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-method-find_config_by_name">New Method: find_config_by_name()<a href="#new-method-find_config_by_name" class="hash-link" aria-label="Direct link to New Method: find_config_by_name()" title="Direct link to New Method: find_config_by_name()">â€‹</a></h2>
<p>We&#x27;ve made stock configurations for each of the services.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def find_config_by_name(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    service_configs: EventServiceConfigList, name: str</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; EventServiceConfig | None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Utility function to find a service config by name.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        service_configs: List of service configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name: Name of the service to find</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for config in service_configs.configs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if config.name == name:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return None</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Should you only provide the name of the service in the configuration
file, this will return a complete configuration for your custom application.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="update-main">Update: main()<a href="#update-main" class="hash-link" aria-label="Direct link to Update: main()" title="Direct link to Update: main()">â€‹</a></h2>
<p>This example is used to demonstrate how you could specify
specific services to subscribe to from the command line.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if __name__ == &quot;__main__&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser = argparse.ArgumentParser(prog=&quot;template-app&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Add additional command line arguments here</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parser.add_argument(&quot;--service-config&quot;, type=Path, default=&quot;service_config.json&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    args = parser.parse_args()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop = asyncio.get_event_loop()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loop.run_until_complete(CameraApp(args.service_config).app_func())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    except asyncio.CancelledError:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loop.close()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>service_config.json is a list of each of the services you&#x27;ve requested
for your application. For this example, its only a single oak service
but it could modified to add more cameras or canbus for example.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-file-service_configjson">Add File: service_config.json<a href="#add-file-service_configjson" class="hash-link" aria-label="Direct link to Add File: service_config.json" title="Direct link to Add File: service_config.json">â€‹</a></h2>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;configs&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;name&quot;: &quot;oak0&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;port&quot;: 50010,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;host&quot;: &quot;localhost&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;log_level&quot;: &quot;INFO&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;subscriptions&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;uri&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;path&quot;: &quot;*&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    &quot;query&quot;: &quot;service_name=oak0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;every_n&quot;: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-setupcfg">Update setup.cfg<a href="#update-setupcfg" class="hash-link" aria-label="Direct link to Update setup.cfg" title="Direct link to Update setup.cfg">â€‹</a></h3>
<p>In order to import everything we need, we must add the library <code>PyTurboJPEG</code> to
the
<a href="https://github.com/farm-ng/camera-streamer/blob/main/setup.cfg" target="_blank" rel="noopener noreferrer"><strong><code>setup.cfg</code></strong></a>
file so the dependency installs.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">install_requires =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wheel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kivy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    farm_ng_amiga</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    PyTurboJPEG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-app">Running the app<a href="#running-the-app" class="hash-link" aria-label="Direct link to Running the app" title="Direct link to Running the app">â€‹</a></h2>
<p>To run the app:</p>
<ol>
<li>run the command <code>./install.sh</code> and click the icon on the brain screen</li>
<li>run the command <code>./entry.sh</code></li>
</ol>
<p><img loading="lazy" src="https://user-images.githubusercontent.com/53625197/216075393-6e578a01-677e-4279-b224-70fd3f73ce5f.png" alt="camera-streamer" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/tutorials/camera_streamer/03_camera_stream.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/camera_streamer/kivy-definition"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">01 - Kivy Definition</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/virtual_joystick/virtual-joystick-overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">00 - Virtual Joystick Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rename-classes" class="table-of-contents__link toc-highlight">Rename Classes</a></li><li><a href="#update-imports" class="table-of-contents__link toc-highlight">Update Imports</a></li><li><a href="#update-cameraapp" class="table-of-contents__link toc-highlight">Update: CameraApp()</a><ul><li><a href="#update-on_exit_btnself" class="table-of-contents__link toc-highlight">Update: on_exit_btn(self)</a></li><li><a href="#update-app_funcself" class="table-of-contents__link toc-highlight">Update: app_func(self)</a></li></ul></li><li><a href="#new-method-stream_camera" class="table-of-contents__link toc-highlight">New Method: stream_camera()</a><ul><li><a href="#event-client" class="table-of-contents__link toc-highlight">Event Client</a></li><li><a href="#decode-and-display" class="table-of-contents__link toc-highlight">Decode and display</a></li></ul></li><li><a href="#new-method-find_config_by_name" class="table-of-contents__link toc-highlight">New Method: find_config_by_name()</a></li><li><a href="#update-main" class="table-of-contents__link toc-highlight">Update: main()</a></li><li><a href="#add-file-service_configjson" class="table-of-contents__link toc-highlight">Add File: service_config.json</a><ul><li><a href="#update-setupcfg" class="table-of-contents__link toc-highlight">Update setup.cfg</a></li></ul></li><li><a href="#running-the-app" class="table-of-contents__link toc-highlight">Running the app</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/contribute-website">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.farm-ng.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item" position="left">Discourse</a></li></ul></div><div class="col footer__col"><div class="footer__title">Farm-ng</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-ng/farm-ng-amiga" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-amiga<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://farm-ng.github.io/farm-ng-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-ros-bridge-v1" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-amiga-ros-bridge<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Sister projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/kornia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Kornia<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/stevenlovegrove/Pangolin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pangolin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://strasdat.github.io/Sophus/latest/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sophus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/farm-ng" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2024 Farm-ng, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>