<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-examples/virtual_joystick/virtual-joystick-widget">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">05 - Virtual Joystick Widget | Farm-ng Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amiga.farm-ng.com/docs/examples/virtual_joystick/virtual-joystick-widget"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="05 - Virtual Joystick Widget | Farm-ng Developers"><meta data-rh="true" name="description" content="Add the VirtualJoystickWidget"><meta data-rh="true" property="og:description" content="Add the VirtualJoystickWidget"><link data-rh="true" rel="icon" href="/img/farm-ng_favicon.png"><link data-rh="true" rel="canonical" href="https://amiga.farm-ng.com/docs/examples/virtual_joystick/virtual-joystick-widget"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/examples/virtual_joystick/virtual-joystick-widget" hreflang="en"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/examples/virtual_joystick/virtual-joystick-widget" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Farm-ng Developers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Farm-ng Developers Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-235819376-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.35aef863.css">
<link rel="preload" href="/assets/js/runtime~main.bc65a0b3.js" as="script">
<link rel="preload" href="/assets/js/main.5d5cc880.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Join Farm-ng Discourse forum ðŸ¤– ðŸšœ <a target="_blank" rel="noopener noreferrer" href="https://discourse.farm-ng.com/"> Announcements, Q&A, share codes or ideas.</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Amiga SDK</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/examples/examples-index">Examples</a><a class="navbar__item navbar__link" href="/docs/api">API</a><a class="navbar__item navbar__link" href="/docs/contribute/contribute-website">Contribute</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://discourse.farm-ng.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="Farm-ng Developers Forum">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.youtube.com/channel/UCczyy8tyLbqxjtLE1_8YW3w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/examples-index">Index</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/hello_main_loop/">CircuitPython Example</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/file_reader/">Brain Example</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/examples/virtual_joystick/virtual-joystick-overview">Virtual Joystick Tutorial</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/virtual-joystick-overview">00 - Virtual Joystick Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/template-starter">01 - Template Starter</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/template-overview">02 - Template Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/canbus-stream">03 - Canbus Stream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/camera-stream">04 - Camera Stream</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/examples/virtual_joystick/virtual-joystick-widget">05 - Virtual Joystick Widget</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/auto-control">06 - Auto Control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/virtual_joystick/further-exercises">07 - Further Exercises</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/brain/brain-apps">Developing Custom Applications</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Virtual Joystick Tutorial</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">05 - Virtual Joystick Widget</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Virtual Joystick Widget</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-the-virtualjoystickwidget">Add the VirtualJoystickWidget<a class="hash-link" href="#add-the-virtualjoystickwidget" title="Direct link to heading">â€‹</a></h3><p>We will now define a custom widget in Python that gives an introduction to kivy drawing.
This widget will be used to drive the robot by moving the virtual joystick on the Brain screen.
The driving behavior is modelled after the behavior of driving with the joystick on the pendant.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="imports">imports<a class="hash-link" href="#imports" title="Direct link to heading">â€‹</a></h4><p>The imports we need to add for this step are:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from math import sqrt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from typing import Tuple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.graphics import Color, Ellipse  # noqa: E402</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from kivy.uix.widget import Widget  # noqa: E402</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Reminder</div><div class="admonitionContent_S0QG"><p>Remember to place all kivy imports below the <code>Config.set(...)</code> lines!</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="relative_cord_in_widget">relative_cord_in_widget<a class="hash-link" href="#relative_cord_in_widget" title="Direct link to heading">â€‹</a></h4><p>Kivy is drawn in pixel coordinates of the <code>Window</code>, starting in the bottom left, with <code>+x</code> to the right and <code>+y</code> up.
In line with this, the coordinates of a <code>MouseMotionEvent</code> (what we call a <code>touch</code>) come by default in these same <code>Window</code> coordinates.</p><p>For our virtual joystick, we want relative coordinates of the touch from the <code>(0, 0)</code> center of the widget, on the range <code>[-1.0, 1.0]</code>.
We also only want to consider touches within the <code>VirtualJoystickWidget</code>, and want to ignore touches on the <code>Image</code> or <code>Label</code> widgets.</p><p>For this purpose, we define a free function that returns the coordinates of the <code>touch</code> on the <code>scale</code> IFF it occurs within the bounds of the <code>widget</code>.
If the touch occurs outside of the widget, <code>None</code> is returned.</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def relative_cord_in_widget(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    widget: Widget, touch: MouseMotionEvent, scale: Tuple[float, float] = (-1.0, 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) -&gt; Optional[Tuple[float, float]]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Returns the coordinates of the touch on the scale IFF it occurs within the bounds of the widget.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_s: Tuple[int, int] = (widget.pos[0], widget.pos[0] + widget.width)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    y_s: Tuple[int, int] = (widget.pos[1], widget.pos[1] + widget.height)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if not (x_s[0] &lt; touch.x &lt; x_s[1]) or not (y_s[0] &lt; touch.y &lt; y_s[1]):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return None</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scale[0] + (touch.x - x_s[0]) * (scale[1] - scale[0]) / (widget.width),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scale[0] + (touch.y - y_s[0]) * (scale[1] - scale[0]) / (widget.height),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="vec2">Vec2<a class="hash-link" href="#vec2" title="Direct link to heading">â€‹</a></h4><p>We also define a simple container for x &amp; y values of these relative coordinates.
The motivation is:</p><ol><li>It is less likely to mix up <code>pose.x</code> and <code>pose.y</code> than it is to mix up <code>pose[0]</code> and <code>pose[1]</code>, if we left the relative coordinates as a <code>Tuple</code>.</li><li>This falls in line with kivy notation that tends to use the <code>*.x</code> &amp; <code>*.y</code> notation as you will soon see</li><li>This allows us to clip values and force them on the range <code>[-1.0, 1.0]</code> we want from the virtual joystick.</li></ol><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Vec2:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Simple container for keeping joystick coords in x &amp; y terms.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Defaults to a centered joystick (0,0). Clips values to range [-1.0, 1.0], as with the Amiga joystick.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, x: float = 0.0, y: float = 0.0) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.x: float = min(max(-1.0, x), 1.0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.y: float = min(max(-1.0, y), 1.0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="virtualjoystickwidget">VirtualJoystickWidget<a class="hash-link" href="#virtualjoystickwidget" title="Direct link to heading">â€‹</a></h4><p>The <code>VirtualJoystickWidget</code> inherits from the kivy <code>Widget</code> class, so it has all the features of a generic <code>Widget</code> and anything we add to it.
For this to actually work, it is important to initialize as:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class VirtualJoystickWidget(Widget):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    def __init__(self, **kwargs) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        super(VirtualJoystickWidget, self).__init__(**kwargs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_pose: Vec2 = Vec2()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.joystick_rad: int = 100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We also add two parameters: one for the relative pose of joystick and one for the size (in pixels) to draw the joystick.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="draw-widget">draw (Widget)<a class="hash-link" href="#draw-widget" title="Direct link to heading">â€‹</a></h4><p>We define how the virtual joystick will draw here, and this function has no requirement from kivy to be named <code>draw</code>.
In this function, we draw in the widget&#x27;s <a href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html" target="_blank" rel="noopener noreferrer"><strong><code>Canvas</code></strong></a>.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>This is the <code>draw()</code> method of the <code>VirtualJoystickWidget</code>.
It is not to be confused with the <code>async draw()</code> method of the <code>VirtualJoystickApp</code></p></div></div><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">def draw(self) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.canvas.clear()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Draw background circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.canvas.add(Color(0.2, 0.2, 0.2, 1.0, mode=&quot;rgba&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.canvas.add(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ellipse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pos=(self.center_x - self.width // 2, self.center_y - self.height // 2), size=(self.width, self.height)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Draw joystick at position</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    x_abs, y_abs = (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.center_x + 0.5 * self.joystick_pose.x * (self.width - 2 * self.joystick_rad),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.center_y + 0.5 * self.joystick_pose.y * (self.height - 2 * self.joystick_rad),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.canvas.add(Color(1.0, 1.0, 0.0, 1.0, mode=&quot;rgba&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    self.canvas.add(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Ellipse(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pos=(x_abs - self.joystick_rad, y_abs - self.joystick_rad),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            size=(self.joystick_rad * 2, self.joystick_rad * 2),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    )</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For each call of <code>draw</code>, we erase what was previously drawn on the widget canvas with the <code>clear()</code> method.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Careful</div><div class="admonitionContent_S0QG"><p>If you are drawing on top of an <code>Image</code> widget, <code>clear()</code> will erase the image too!</p></div></div><p>We draw two shapes on the canvas with the kivy <a href="https://kivy.org/doc/stable/api-kivy.graphics.html" target="_blank" rel="noopener noreferrer"><strong>Graphics</strong></a> package.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Reminder</div><div class="admonitionContent_S0QG"><p>Kivy is drawn in pixel coordinates of the <code>Window</code>, starting in the bottom left, with <code>+x</code> to the right and <code>+y</code> up.</p></div></div><p>We use <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html" target="_blank" rel="noopener noreferrer"><strong><code>Widget</code></strong></a> parameters, such as <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.center" target="_blank" rel="noopener noreferrer"><strong><code>center</code></strong></a>, <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" target="_blank" rel="noopener noreferrer"><strong><code>pos</code></strong></a>, and <a href="https://kivy.org/doc/stable/api-kivy.uix.widget.html#kivy.uix.widget.Widget.pos" target="_blank" rel="noopener noreferrer"><strong><code>size</code></strong></a>, to determine where to draw the stable circle representing the range of the joystick.</p><p>We do the same for the moving joystick, but map the <code>joystick_pose</code> value into pixel coordinates, and offset it from the center of the <code>VirtualJoystickWidget</code>.</p><ul><li>Reference: <a href="https://kivy.org/doc/stable/api-kivy.graphics.instructions.html" target="_blank" rel="noopener noreferrer"><strong><code>Canvas</code></strong></a></li><li>Reference: <a href="https://kivy.org/doc/stable/api-kivy.graphics.html" target="_blank" rel="noopener noreferrer"><strong>Graphics</strong></a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="draw-app">draw (App)<a class="hash-link" href="#draw-app" title="Direct link to heading">â€‹</a></h4><p>The <code>draw()</code> method in the <code>VirtualJoystickApp</code> needs to be updated to call the <code>draw()</code> method in the <code>VirtualJoystickWidget</code> every loop.</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">async def draw(self) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;&quot;Loop over drawing the VirtualJoystickWidget.&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while self.root is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await asyncio.sleep(0.01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joystick: VirtualJoystickWidget = self.root.ids[&quot;joystick&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while True:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        joystick.draw()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self.update_kivy_strings()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        await asyncio.sleep(0.01)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the root of the kivy app is created, the <code>VirtualJoystickWidget</code> can accessed by its <code>id:</code>.</p><p>We then loop forever, continuously drawing the <code>VirtualJoystickWidget</code> and updating the <code>StringProperty</code> strings displayed as <code>Label</code> widgets, containing values from the most recent <code>AmigaTpdo1</code> message with our simple <code>update_kivy_strings()</code> method from before.</p><p>Lastly, we sleep for our default duration of 10ms before the next iteration.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="add-to-kv-string">Add to kv string<a class="hash-link" href="#add-to-kv-string" title="Direct link to heading">â€‹</a></h4><p>Now that we have defined our custom <code>Widget</code>, we can add it to the kv string.</p><p>At the top of the kv string, before we must declare this custom widget and that it inherits from the kivy <code>Widget</code> class.</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kv = &quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;VirtualJoystickWidget@Widget&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RelativeLayout:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Button:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can then add the <code>VirtualJoystickWidget</code> in the parent <code>BoxLayout</code>, between the <code>BoxLayout</code> of <code>Label</code> widgets and the <code>TabbedPanel</code>.</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">VirtualJoystickWidget:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    id: joystick</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Ensure the <code>VirtualJoystickWidget</code> is indexed to the same level as the <code>BoxLayout</code> of <code>Label</code> widgets and the <code>TabbedPanel</code>.</p></div></div><p>We then have a <code>BoxLayout</code> that stacks 3 sub-widgets horizontally (by default):</p><ol><li>Another <code>BoxLayout</code> with 3 vertically stacked labels</li><li>A custom <code>Widget</code> called <code>VirtualJoystickWidget</code>, defined in Python</li><li>A <a href="https://kivy.org/doc/stable/api-kivy.uix.tabbedpanel.html" target="_blank" rel="noopener noreferrer"><strong><code>TabbedPanel</code></strong></a>.</li></ol><p>Since the <code>VirtualJoystickWidget</code> is fully defined in Python below, the only details we need to add is the <code>id:</code>, so the Widget can be easily referenced by the <code>App</code>.</p><p>You could add more details here to customize various <code>Widget</code> parameters, for instance a <code>size_hint</code>, but we just leave the default size to be used.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="touch-handling">touch handling<a class="hash-link" href="#touch-handling" title="Direct link to heading">â€‹</a></h4><p>If you were to sync the app to the Brain and run it now, you could see the <code>VirtualJoystickWidget</code> but it would not interact with your touches.
We need to replace the placeholder comments in the 3 touch handling functions of the <code>VirtualJoystickApp</code>, nested in the <code>build()</code> method.</p><p>In both <code>on_touch_down</code> and <code>on_touch_move</code>, we want to assign a <code>Vec2</code> of the relative coordinates of the &quot;touch&quot; to the <code>joystick_pose</code> member of the <code>VirtualJoystickWidget</code>.
This way the virtual joystick will move to wherever we press our finger and move it around to, within the widget.</p><p>Replace:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Add additional on_touch_XXXXX behavior here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>with:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">joystick: VirtualJoystickWidget = self.root.ids[&quot;joystick&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">res: Optional[Tuple[float, float]] = relative_cord_in_widget(widget=joystick, touch=touch)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if res:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    # Clip to unit circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    div: float = max(1.0, sqrt(res[0] ** 2 + res[1] ** 2))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    joystick.joystick_pose = Vec2(x=res[0] / div, y=res[1] / div)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we access the <code>VirtualJoystickWidget</code> with the <code>id:</code> value from the kv string.
We then get the relative coordinates of the &quot;touch&quot; in the widget.</p><p>If those coordinates are not within the widget, the <code>joystick_pose</code> is not updated.
This happens, for example, when you click on the <code>Image</code> widget or when you slide your finger from within the <code>VirtualJoystickWidget</code> widget to the <code>Label</code> widgets.</p><p>If the coordinates are within the <code>VirtualJoystickWidget</code>, we update the <code>joystick_pose</code> with the coordinates clipped to the unit circle (like a real joystick where the range of motion is circular).</p><p>For <code>on_touch_up</code>, however, we want the joystick to return to it&#x27;s centered position when it is released.</p><p>Replace:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Add additional on_touch_XXXXX behavior here</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>with:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">joystick: VirtualJoystickWidget = self.root.ids[&quot;joystick&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">joystick.joystick_pose = Vec2()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we set the <code>joystick_pose</code> back to a default <code>Vec2</code> pose of <code>(0,0)</code> whenever we release our touch.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-the-app---virtual-joystick">Run the app - virtual joystick<a class="hash-link" href="#run-the-app---virtual-joystick" title="Direct link to heading">â€‹</a></h3><p>Now sync the app to the Brain and launch it with the following instructions!</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Deploy Instructions</div><div class="admonitionContent_S0QG"><p><a href="/docs/brain/brain-apps"><strong>Deploy Instructions</strong></a> for syncing the app onto the Amiga Brain.</p></div></div><p>You should now see the virtual joystick between the camera stream (far right) and the <code>AmigaTpdo1</code> values from the canbus (left).
Try moving the joystick around with your finger and releasing it, but note: It won&#x27;t drive yet!</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/53625197/200641720-c722fa9f-f6a3-4918-a4f0-d7270b73fd43.png" alt="joystick" class="img_ev3q"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Coming soon</div><div class="admonitionContent_S0QG"><p>Link to this checkpoint</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/examples/virtual_joystick/05_virtual_joystick_widget.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/examples/virtual_joystick/camera-stream"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">04 - Camera Stream</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/examples/virtual_joystick/auto-control"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">06 - Auto Control</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#add-the-virtualjoystickwidget" class="table-of-contents__link toc-highlight">Add the VirtualJoystickWidget</a></li><li><a href="#run-the-app---virtual-joystick" class="table-of-contents__link toc-highlight">Run the app - virtual joystick</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/examples/examples-index">Examples</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api">API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.farm-ng.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/contribute-website">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Farm-ng, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bc65a0b3.js"></script>
<script src="/assets/js/main.5d5cc880.js"></script>
</body>
</html>