<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-examples/hello_main_loop/hello-world">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Hello Main Loop Example | Farm-ng Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amiga.farm-ng.com/docs/examples/hello_main_loop/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Hello Main Loop Example | Farm-ng Developers"><meta data-rh="true" name="description" content="Link to hellomainloop/code.py"><meta data-rh="true" property="og:description" content="Link to hellomainloop/code.py"><link data-rh="true" rel="icon" href="/img/farm-ng_favicon.png"><link data-rh="true" rel="canonical" href="https://amiga.farm-ng.com/docs/examples/hello_main_loop/"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/examples/hello_main_loop/" hreflang="en"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/examples/hello_main_loop/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Farm-ng Developers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Farm-ng Developers Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-235819376-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.35aef863.css">
<link rel="preload" href="/assets/js/runtime~main.a7b895ce.js" as="script">
<link rel="preload" href="/assets/js/main.1130571a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Join Farm-ng Discourse forum ðŸ¤– ðŸšœ <a target="_blank" rel="noopener noreferrer" href="https://discourse.farm-ng.com/"> Announcements, Q&A, share codes or ideas.</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Amiga SDK</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/examples/examples-index">Examples</a><a class="navbar__item navbar__link" href="/docs/api">API</a><a class="navbar__item navbar__link" href="/docs/contribute/contribute-website">Contribute</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://discourse.farm-ng.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link" aria-label="Farm-ng Developers Forum">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://www.youtube.com/channel/UCczyy8tyLbqxjtLE1_8YW3w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/examples-index">Index</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/examples/hello_main_loop/">CircuitPython Examples</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/examples/hello_main_loop/">Hello Main Loop Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/cansniffer/">Cansniffer Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/examples/FPV/">FPV Example</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/import_log_file/">Brain Example</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/tutorials/introduction/tutorial-introduction">Brain App Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/brain/brain-apps">Developing Custom Applications</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">CircuitPython Examples</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Hello Main Loop Example</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Hello Main Loop Example</h1><h3 class="anchor anchorWithStickyNavbar_LWe7" id="link-to-hello_main_loopcodepy"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/circuitpy/examples/hello_main_loop/code.py" target="_blank" rel="noopener noreferrer">Link to <code>hello_main_loop/code.py</code></a><a class="hash-link" href="#link-to-hello_main_loopcodepy" title="Direct link to heading">â€‹</a></h3><p>This introductory example covers getting set up, interacting with the Amiga, and
using auto-control mode to drive your Amiga from a computer
using the <a href="https://farm-ng.com/products/microcontroller-kit" target="_blank" rel="noopener noreferrer"><strong>farm-ng microcontroller kit</strong></a>.</p><p>This example enables driving the Amiga by entering simple fwd / rev / left / right keyboard commands the serial port, which the app sends over the CAN bus.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="parts-required">Parts required:<a class="hash-link" href="#parts-required" title="Direct link to heading">â€‹</a></h2><ul><li><a href="https://farm-ng.com/products/microcontroller-kit" target="_blank" rel="noopener noreferrer"><strong>farm-ng microcontroller kit</strong></a> (w/ USB-C cable)</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="code-breakdown">Code Breakdown<a class="hash-link" href="#code-breakdown" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="imports-from-lib">Imports from <code>lib/</code><a class="hash-link" href="#imports-from-lib" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="mainloop"><code>MainLoop</code><a class="hash-link" href="#mainloop" title="Direct link to heading">â€‹</a></h4><p>The <code>MainLoop</code> class is used throughout the application layer of the farm-ng firmware.
<code>MainLoop</code> contains generic functionality we use on our pendant, dashboard, and auxiliary components for constant looping, receiving of CAN messages, sending of regular status updates called <code>Heartbeats</code>, and more.
The <code>MainLoop</code> takes an <code>AppClass</code> in the constructor, and the <code>AppClass</code> is expected to contain a method called <code>iter</code> that is called every in every iteration (also called <code>iter</code>) of the <code>MainLoop</code>.</p><p>The <code>_register_message_handlers()</code> method is an important feature to note.
This method adds parsing directly into the MainLoop so the App only receives the desired CAN messages.
Because messages sent on the CAN bus are seen by all other components
it is important to efficiently filter out irrelevant messages
on the resource constrained microcontrollers.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Take it further:</div><div class="admonitionContent_S0QG"><p>Try to add an additional message parser for one of the other messages on the CAN bus.
For instance, if you have a pendant connected to your CAN bus you could add something like:</p><div class="language-Python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.utils.packet import  PENDANT_NODE_ID, PendantState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _register_message_handlers(self):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   self.main_loop.command_handlers[CanOpenObject.TPDO1 | DASHBOARD_NODE_ID] = self._handle_amiga_tpdo1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   self.main_loop.command_handlers[CanOpenObject.TPDO1 | PENDANT_NODE_ID] = self._handle_pendant_state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">def _handle_pendant_state(self, message):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   pendant_state = PendantState.from_can_data(message.data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   print(pendant_state)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All messages on the bus can be found by using the <a href="/docs/examples/cansniffer/"><strong>cansniffer example app</strong></a>.
You can compare the detected CAN ID&#x27;s to those in <code>CanOpenObject</code>. But keep in mind, node id is added
to the function code for the full CAN Id, as you&#x27;ll see below in
<a href="#canopenobject--dashboard_node_id"><strong>CanOpenObject / DASHBOARD_NODE_ID</strong></a>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tickrepeater"><code>TickRepeater</code><a class="hash-link" href="#tickrepeater" title="Direct link to heading">â€‹</a></h4><p>The <code>TickRepeater</code> class is a useful utility that we recommend taking advantage of throughout your custom implementations.
We use &quot;repeaters&quot; to limit the frequency of certain actions, by only performing the action once the <code>period</code> of the repeater has past, when compared to the last time the action was performed.
The <code>check()</code> method returns <code>False</code> until the checkpoint has past, and <code>True</code> once the checkpoint is past.
When <code>True</code> is returned, the repeater is updated to the next checkpoint, so you really only need the <code>check()</code> method in most applications.</p><p>The <code>TickRepeater</code> is what we call a &quot;catch-up&quot; repeater, in which the the next checkpoint is the <code>ticks_period_ms</code> (period in ms) added to the last checkpoint (rather than the next checkpoint being the <code>ticks_period_ms</code> added to the time of last execution).
As you can infer, there&#x27;s no reason to use one of these catch-up repeaters if the <code>check()</code> will be called less frequently than the <code>ticks_period_ms</code> used in the constructor.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span><mdxadmonitiontitle><code>ticks_ms</code></mdxadmonitiontitle></div><div class="admonitionContent_S0QG"><p>We use <code>ticks_ms</code>
which wraps every <code>2^29</code> ms (~6.2 days).
Our logic handles a single wrap, but we do not detect two wraps
as we use this in periods more on the <code>100 ms</code> timescale.
If you are creating a long duration application,
just make sure your period is less than 6 days and that the check
is called at least that often.</p><p>See the <a href="https://docs.circuitpython.org/en/latest/shared-bindings/supervisor/#supervisor.ticks_ms" target="_blank" rel="noopener noreferrer"><strong><code>supervisor.ticks_ms()</code> docs</strong></a>
for more details about <code>ticks_ms</code>.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="amigarpdo1">AmigaRpdo1<a class="hash-link" href="#amigarpdo1" title="Direct link to heading">â€‹</a></h4><p>Wrapper for CAN packet used for auto mode controls of the Amiga.
Provide the<code>AmigaRpdo1</code> object with a requested <code>AmigaControlState</code>, speed, and angular rate.
Then pack this into a <a href="https://docs.circuitpython.org/en/latest/shared-bindings/canio/index.html#canio.Message" target="_blank" rel="noopener noreferrer"><strong><code>canio.Message</code></strong></a> and send this message over the bus.</p><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>This is a <strong><em>request</em></strong> for a specific <code>AmigaControlState</code>, angular rate, and linear velocity sent to the dashboard.
The dashboard, operating as the vehicle control unit (VCU), has built-in logic to prevent unsafe speeds, accelerations, control state transitions, etc.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="amigatpdo1">AmigaTpdo1<a class="hash-link" href="#amigatpdo1" title="Direct link to heading">â€‹</a></h4><p>Wrapper for CAN packet used for sending state of the Amiga, including <code>AmigaControlState</code>.
Unpack the message to see the current <code>AmigaControlState</code>, speed, and angular rate of the robot.</p><p>There is a convenient util function <code>from_can_data</code> that unpacks the message directly into an <code>AmigaTpdo1</code> object.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="amigacontrolstate">AmigaControlState<a class="hash-link" href="#amigacontrolstate" title="Direct link to heading">â€‹</a></h4><p>Control state of the Amiga.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="canopenobject--dashboard_node_id">CanOpenObject / DASHBOARD_NODE_ID<a class="hash-link" href="#canopenobject--dashboard_node_id" title="Direct link to heading">â€‹</a></h4><p>We <em>mostly</em> follow the CANopen standards.
A recommended reading is the <a href="https://www.csselectronics.com/pages/canopen-tutorial-simple-intro" target="_blank" rel="noopener noreferrer"><strong>CSS Electronics CANopen tutorial</strong></a>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>Some of the third-party, auxiliary components we have integrated into the system do not allow for strict adherence to the CANopen standards.
For our core system, we adhere closely to the standards.</p></div></div><p>In this standard, messages are passed using function codes based on their use.
Each component has a node ID identifier used to identify either the intended recipient or the source component of each message sent on the CAN bus.
In the current example, we send requested commands to the Amiga on the <code>RPDO1</code> channel, and receive responses streamed from the Amiga on the <code>TPDO1</code> channel.
These are differentiated from pendant or motor controller RPDO/TPDO command sets by sending them with the dashboard node ID.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="codepy">code.py<a class="hash-link" href="#codepy" title="Direct link to heading">â€‹</a></h3><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>code.py (or main.py) is the default name for the executable Python file on microcontrollers flashed with CircuitPython.
You&#x27;ll see we stick to the code.py convention with our files.</p></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="hellomainloopapp">HelloMainLoopApp<a class="hash-link" href="#hellomainloopapp" title="Direct link to heading">â€‹</a></h4><p>Here we create <code>HelloMainLoopApp</code> as a simple example of the types of <code>AppClass</code> you can create.</p><p>In our <code>HelloMainLoopApp</code> constructor, we create a <code>TickRepeater</code> that will stream the automatic control command to the dashboard every 50 ms (at a 20hz rate).</p><p>In our <code>iter()</code> call, we:</p><ul><li>Check for control keys entered into the serial console [<code>&lt;space bar&gt;</code> for toggling auto mode, &amp; <code>w</code> / <code>a</code> / <code>s</code> / <code>d</code> <!-- -->[fwd / left / rev / right]<!-- --> for adjusting velocities].</li><li>Parse through all received CAN messages, sorting only for the <code>AmigaTpdo1</code> responses coming from the dashboard.</li><li>Send the most up-to-date auto control commands, based on serial console entries, in an <code>AmigaRpdo1</code> formatted packet.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="instructions">Instructions<a class="hash-link" href="#instructions" title="Direct link to heading">â€‹</a></h2><ol><li><p>Connect your microcontroller as in the following diagram:</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/53625197/187538323-f70bb5d5-8c9a-40c2-ab75-25fd6c80acfb.png" class="img_ev3q"></p></li><li><p>From <code>amiga-dev-kit/circuitpy/</code>, drop the <code>code.py</code> file and the <code>lib/</code> folder directly into the root of the mounted <code>CIRCUITPY</code> drive, as seen below.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This assumes you have already cloned the amiga-dev-kit repo.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">to_your_base_directory</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone git@github.com:farm-ng/amiga-dev-kit.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></li></ol><p><img loading="lazy" src="https://user-images.githubusercontent.com/53625197/187538475-9d301b0f-f303-4ead-a1e7-b55c6b449b9f.png" alt="hello_main_loop_filesystem" class="img_ev3q"></p><ol start="3"><li><p>Open the serial console.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Mu is the recommended serial console program by adafruit on their <a href="https://learn.adafruit.com/welcome-to-circuitpython/kattni-connecting-to-the-serial-console" target="_blank" rel="noopener noreferrer"><strong>CircuitPython serial console page</strong></a>.
Mu has a built in plotter for tuples printed to the serial console (print statements in the python code on your microcontroller).</p><p>We&#x27;ve found that Mu can be a little unstable and freezes occasionally,
so we&#x27;d recommend checking out their links for the &quot;advanced&quot; serial console:</p><ul><li><a href="https://learn.adafruit.com/welcome-to-circuitpython/advanced-serial-console-on-windows" target="_blank" rel="noopener noreferrer"><strong>Windows serial console</strong></a></li><li><a href="https://learn.adafruit.com/welcome-to-circuitpython/advanced-serial-console-on-linux" target="_blank" rel="noopener noreferrer"><strong>Linux serial console</strong></a></li><li><a href="https://learn.adafruit.com/welcome-to-circuitpython/advanced-serial-console-on-mac-and-linux" target="_blank" rel="noopener noreferrer"><strong>Mac serial console</strong></a></li></ul></div></div></li></ol><p>You should see an output of the current state of the robot, similar to the screenshot below, and you should see the values update as the robot drives around.</p><p><img loading="lazy" src="https://user-images.githubusercontent.com/53625197/187538512-90d53da9-8588-4d15-9973-49cca16bff72.png" alt="hello_main_loop_console" class="img_ev3q"></p><ol start="4"><li>Navigate to the Auto mode tab on your dashboard, and click the <code>[AUTO CONTROL]</code> button. The <code>[AUTO READY]</code> icon should turn yellow, indicating the dashboard is ready for a component to take <code>Auto Control</code>.</li><li>Hit the space bar in your serial console to request auto control, and you should see the <code>[AUTO READY]</code> turn green, indicating the dashboard is in <code>Auto Control</code> mode.<ol><li>The space bar may not register every press, so use the dash indicators!</li></ol></li><li>In the serial console, increase / decrease the robot forward / reverse speed with the <code>w</code> &amp; <code>s</code> keys, and increase / decrease the robot angular rate with the <code>a</code> &amp; <code>d</code> keys.</li><li>Hit the space bar in the serial console to release auto control and return to the <code>[AUTO READY]</code> state. Or hit the E-stop on your Amiga!</li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/examples/hello_main_loop/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/examples/examples-index"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Examples Index</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/examples/cansniffer/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Cansniffer Example</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#link-to-hello_main_loopcodepy" class="table-of-contents__link toc-highlight">Link to <code>hello_main_loop/code.py</code></a></li><li><a href="#parts-required" class="table-of-contents__link toc-highlight">Parts required:</a></li><li><a href="#code-breakdown" class="table-of-contents__link toc-highlight">Code Breakdown</a><ul><li><a href="#imports-from-lib" class="table-of-contents__link toc-highlight">Imports from <code>lib/</code></a></li><li><a href="#codepy" class="table-of-contents__link toc-highlight">code.py</a></li></ul></li><li><a href="#instructions" class="table-of-contents__link toc-highlight">Instructions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/examples/examples-index">Examples</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api">API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.farm-ng.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/contribute-website">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">farm-ng and sister projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://farm-ng.github.io/farm-ng-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://strasdat.github.io/Sophus/latest/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sophus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/stevenlovegrove/Pangolin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pangolin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://amiga.farm-ng.com/docs/getting-started" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amiga Development Kit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Farm-ng, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a7b895ce.js"></script>
<script src="/assets/js/main.1130571a.js"></script>
</body>
</html>