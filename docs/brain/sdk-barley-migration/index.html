<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-brain/sdk-barley-migration" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Migration Guide to Amiga OS 2.0 | Farm-ng Developers</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://amiga.farm-ng.com/docs/brain/sdk-barley-migration"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Migration Guide to Amiga OS 2.0 | Farm-ng Developers"><meta data-rh="true" name="description" content="Preamble"><meta data-rh="true" property="og:description" content="Preamble"><link data-rh="true" rel="icon" href="/img/farm-ng_favicon.png"><link data-rh="true" rel="canonical" href="https://amiga.farm-ng.com/docs/brain/sdk-barley-migration"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/brain/sdk-barley-migration" hreflang="en"><link data-rh="true" rel="alternate" href="https://amiga.farm-ng.com/docs/brain/sdk-barley-migration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EWY2LBZNZX-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Farm-ng Developers RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Farm-ng Developers Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-235819376-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Farm-ng Developers" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.c29cff4a.css">
<script src="/assets/js/runtime~main.ef0fe5da.js" defer="defer"></script>
<script src="/assets/js/main.082ac78d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="content_knG7 announcementBarContent_xLdY">Join Farm-ng Discourse forum ðŸ¤– ðŸšœ <a target="_blank" rel="noopener noreferrer" href="https://discourse.farm-ng.com/"> Announcements, Q&A, share codes or ideas.</a>.</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/farm-ng_favicon.png" alt="Amiga Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Amiga SDK</b></a><a class="navbar__item navbar__link" href="/docs/getting-started">Introduction</a><a class="navbar__item navbar__link" href="/docs/concepts/">Concepts</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/examples/examples-index">Examples</a><a class="navbar__item navbar__link" href="/docs/api/">API</a><a href="https://farm-ng.com/pages/about-farm-ng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">About Us</a><a href="https://discourse.farm-ng.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Discuss</a><a href="https://farm-ng.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Shop</a></div><div class="navbar__items navbar__items--right"><a href="https://www.youtube.com/channel/UCczyy8tyLbqxjtLE1_8YW3w" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="Youtube"></a><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/examples/examples-index">Examples Index</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/hello_main_loop/">Microcontroller Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/examples/events_recorder/">Brain Examples</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/brain/brain-apps">Amiga Brain Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/brain/brain-apps">Custom Applications (ReactJS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/brain/brain-apps-kivy">Custom Applications (Kivy)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/brain/brain-apps-manifest">Custom Applications Manifest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/brain/sdk-barley-migration">Migration Guide to Amiga OS 2.0</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/brain/ros-bridge">Amiga ROS Bridge</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Amiga Brain Development</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Migration Guide to Amiga OS 2.0</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Migration Guide to Amiga OS 2.0</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preamble">Preamble<a href="#preamble" class="hash-link" aria-label="Direct link to Preamble" title="Direct link to Preamble">â€‹</a></h2>
<p>On November 2023, we released <strong>Amiga OS 2.0 Barley</strong>, which is a major update to the Amiga OS 1.0 Artichoke. This update includes a number of breaking changes to the Amiga OS 1.0 Artichoke API.</p>
<p>This guide will help you migrate your code from Amiga OS 1.0 Artichoke to Amiga OS 2.0 Barley. For more information about the Amiga OS 2.0 Barley release, please see the <a href="/docs/release-notes/release-02"><strong>release notes</strong></a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">â€‹</a></h2>
<p>This guide assumes that:</p>
<ul>
<li>You have knowledge of the Amiga OS 1.0 Artichoke API.</li>
<li>You have an Amiga Brain running Amiga OS 2.0 Barley.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-steps">Migration Steps<a href="#migration-steps" class="hash-link" aria-label="Direct link to Migration Steps" title="Direct link to Migration Steps">â€‹</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-amiga-brain-sdk">Update the Amiga Brain SDK<a href="#update-the-amiga-brain-sdk" class="hash-link" aria-label="Direct link to Update the Amiga Brain SDK" title="Direct link to Update the Amiga Brain SDK">â€‹</a></h3>
<p>With the release of Amiga OS 2.0 Barley, we have also released a new version of the Amiga Brain SDK. This new version of the SDK contains the new Amiga OS 2.0 Barley API including new features and breaking changes for the following python packages:</p>
<ul>
<li><a href="https://github.com/farm-ng/farm-ng-core/releases/tag/v2.0.0" target="_blank" rel="noopener noreferrer"><code>farm_ng_core</code></a>  latest version is <code>2.0.0</code></li>
<li><a href="https://github.com/farm-ng/farm-ng-amiga/releases/tag/v2.0.0" target="_blank" rel="noopener noreferrer"><code>farm_ng_amiga</code></a> latest version is <code>2.0.0</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="service-api">Service API<a href="#service-api" class="hash-link" aria-label="Direct link to Service API" title="Direct link to Service API">â€‹</a></h3>
<p>In <code>farm-ng-core</code> we have introduced a new service API. This API is used to communicate with the Amiga Brain services. The service API is a framework that allows you to create service clients and service servers and share protobuf messages between them.</p>
<p>In particular, we have introduced the new main classes:</p>
<ul>
<li><a href="https://github.com/farm-ng/farm-ng-core/blob/75c13325a156613f6c60b9c517f1ef8b87e8cace/py/farm_ng/core/event_service.py#L67" target="_blank" rel="noopener noreferrer"><code>EventServiceGrpc</code></a> This class is used to publish events to the Amiga Brain network.</li>
<li><a href="https://github.com/farm-ng/farm-ng-core/blob/75c13325a156613f6c60b9c517f1ef8b87e8cace/py/farm_ng/core/event_client.py#L66" target="_blank" rel="noopener noreferrer"><code>EventClient</code></a> This class is used to subscribe to events from the Amiga Brain network.</li>
</ul>
<p>We recommend to visit the following tutorials to learn more about the new service API:</p>
<ul>
<li><a href="/docs/examples/service_client"><strong>Service Client</strong></a>: This tutorial will show you how to create a service client to communicate with the Amiga Brain services.</li>
<li><a href="/docs/examples/service_counter"><strong>Service Counter</strong></a>: A bit more advanced tutorial that will show you how to create a service client to create a service that counts the number of times it has been called.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-kivy-camera-streamer-api">Example: Kivy camera streamer api<a href="#example-kivy-camera-streamer-api" class="hash-link" aria-label="Direct link to Example: Kivy camera streamer api" title="Direct link to Example: Kivy camera streamer api">â€‹</a></h3>
<p>In this example we will show you how to migrate the <a href="https://github.com/farm-ng/camera-streamer-kivy" target="_blank" rel="noopener noreferrer"><strong>Kivy camera streamer</strong></a> example using the new service API.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-package">Update the package<a href="#update-the-package" class="hash-link" aria-label="Direct link to Update the package" title="Direct link to Update the package">â€‹</a></h4>
<p>In order to use the new application within the brain, we have to include
the <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/install.sh" target="_blank" rel="noopener noreferrer"><code>install.sh</code></a>, <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/main/uninstall.sh" target="_blank" rel="noopener noreferrer"><code>uninstall.sh</code></a> and <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/main/manifest.json" target="_blank" rel="noopener noreferrer"><code>manifest.json</code></a> files in the root of the package.</p>
<p>We suggest to follow the <a href="/docs/brain/brain-apps-kivy"><strong>Amiga Brain SDK</strong></a> guide to learn more about how to create a package for the Amiga Brain.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-dependencies">Update the dependencies<a href="#update-the-dependencies" class="hash-link" aria-label="Direct link to Update the dependencies" title="Direct link to Update the dependencies">â€‹</a></h4>
<p>As mentioned before, we have to update the dependencies to use the new version of the <code>farm_ng_core</code> and <code>farm_ng_amiga</code> packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip install -U farm_ng_core farm_ng_amiga</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>check the version of the packages:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pip list | grep farm-ng</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># farm-ng-amiga 2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># farm-ng-core 2.0.0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Alternatively, make sure that in the <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/setup.cfg" target="_blank" rel="noopener noreferrer"><code>setup.cfg</code></a>, the <code>farm_ng_core</code> and <code>farm_ng_amiga</code> packages are pointing to the latest version:</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">install_requires =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wheel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kivy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    farm_ng_amiga&gt;=2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    farm_ng_core&gt;=2.0.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    kornia-rs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="update-the-code">Update the code<a href="#update-the-code" class="hash-link" aria-label="Direct link to Update the code" title="Direct link to Update the code">â€‹</a></h4>
<p>In the <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/src/main.py" target="_blank" rel="noopener noreferrer"><code>main.py</code></a> file we have to import the new service API:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_client import EventClient</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import EventServiceConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import EventServiceConfigList</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.event_service_pb2 import SubscribeRequest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.events_file_reader import proto_from_json_file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">from farm_ng.core.uri_pb2 import Uri</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Later, in the implementation of the coroutine <a href="https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/src/main.py#L85C3-L102C25" target="_blank" rel="noopener noreferrer"><code>stream_camera</code></a>, we have to create a new <code>EventClient</code> to leverage the new <code>subscribe</code> API to subscribe to the camera events in an asynchronous fashion.</p>
<p>Note that we can configure the subscription via the <code>SubscribeRequest</code> message. In this case, we are subscribing to the <code>/rgb</code> topic and we are requesting to receive every <code>n</code> messages.</p>
<p>The block below should reflect how to use the new <code>EventClient</code> API:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  async def stream_camera(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        self, view_name: Literal[&quot;rgb&quot;, &quot;disparity&quot;, &quot;left&quot;, &quot;right&quot;] = &quot;rgb&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) -&gt; None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while self.root is None:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            await asyncio.sleep(0.01)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        async for _, message in EventClient(self.service_config).subscribe(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            SubscribeRequest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                uri=Uri(path=f&quot;/{view_name}&quot;), every_n=self.stream_every_n</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            decode=True,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ):</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            try:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                img = self.image_decoder.decode(message.image_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            except Exception as e:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.exception(f&quot;Error decoding image: {e}&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                continue</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once you are done and launch the app, you should see the following:</p>
<p><img loading="lazy" src="https://github.com/farm-ng/amiga-dev-kit/assets/5157099/16ae3485-66c2-4b28-8f44-e8457f235689" alt="Screenshot from 2023-12-01 17-50-01" class="img_ev3q"></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/brain/sdk-barley-migration.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/brain/brain-apps-manifest"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Custom Applications Manifest</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/brain/ros-bridge"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Amiga ROS Bridge</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preamble" class="table-of-contents__link toc-highlight">Preamble</a></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#migration-steps" class="table-of-contents__link toc-highlight">Migration Steps</a><ul><li><a href="#update-the-amiga-brain-sdk" class="table-of-contents__link toc-highlight">Update the Amiga Brain SDK</a></li><li><a href="#service-api" class="table-of-contents__link toc-highlight">Service API</a></li><li><a href="#example-kivy-camera-streamer-api" class="table-of-contents__link toc-highlight">Example: Kivy camera streamer api</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/examples/examples-index">Examples</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api">API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discourse.farm-ng.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/docs/contribute/contribute-website">Contribute</a></li></ul></div><div class="col footer__col"><div class="footer__title">farm-ng and sister projects</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://farm-ng.github.io/farm-ng-core/" target="_blank" rel="noopener noreferrer" class="footer__link-item">farm-ng-core<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://strasdat.github.io/Sophus/latest/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sophus<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/stevenlovegrove/Pangolin" target="_blank" rel="noopener noreferrer" class="footer__link-item">Pangolin<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://amiga.farm-ng.com/docs/getting-started" target="_blank" rel="noopener noreferrer" class="footer__link-item">Amiga Development Kit<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/release-notes/release-02">Release Notes</a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/farm-ng/amiga-dev-kit/blob/main/LICENSE" target="_blank" rel="noopener noreferrer" class="footer__link-item">License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2023 Farm-ng, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>