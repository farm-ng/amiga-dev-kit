"use strict";(self.webpackChunkamiga_developers_website=self.webpackChunkamiga_developers_website||[]).push([[8901],{8678:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>o,contentTitle:()=>t,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var r=n(5893),a=n(1151);const s={id:"sdk-barley-migration",title:"Migration Guide to Amiga OS 2.0"},t="Migration Guide to Amiga OS 2.0",c={id:"brain/sdk-barley-migration",title:"Migration Guide to Amiga OS 2.0",description:"Preamble",source:"@site/docs/brain/sdk-barley-migration.mdx",sourceDirName:"brain",slug:"/brain/sdk-barley-migration",permalink:"/docs/brain/sdk-barley-migration",draft:!1,unlisted:!1,editUrl:"https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/brain/sdk-barley-migration.mdx",tags:[],version:"current",frontMatter:{id:"sdk-barley-migration",title:"Migration Guide to Amiga OS 2.0"},sidebar:"examples",previous:{title:"Custom Applications (Kivy)",permalink:"/docs/brain/brain-apps-kivy"},next:{title:"Amiga ROS Bridge",permalink:"/docs/brain/ros-bridge"}},o={},l=[{value:"Preamble",id:"preamble",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migration Steps",id:"migration-steps",level:2},{value:"Update the Amiga Brain SDK",id:"update-the-amiga-brain-sdk",level:3},{value:"Service API",id:"service-api",level:3},{value:"Example: Kivy camera streamer api",id:"example-kivy-camera-streamer-api",level:3},{value:"Update the package",id:"update-the-package",level:4},{value:"Update the dependencies",id:"update-the-dependencies",level:4},{value:"Update the code",id:"update-the-code",level:4}];function h(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.h1,{id:"migration-guide-to-amiga-os-20",children:"Migration Guide to Amiga OS 2.0"}),"\n",(0,r.jsx)(i.h2,{id:"preamble",children:"Preamble"}),"\n",(0,r.jsxs)(i.p,{children:["On November 2023, we released ",(0,r.jsx)(i.strong,{children:"Amiga OS 2.0 Barley"}),", which is a major update to the Amiga OS 1.0 Artichoke. This update includes a number of breaking changes to the Amiga OS 1.0 Artichoke API."]}),"\n",(0,r.jsxs)(i.p,{children:["This guide will help you migrate your code from Amiga OS 1.0 Artichoke to Amiga OS 2.0 Barley. For more information about the Amiga OS 2.0 Barley release, please see the ",(0,r.jsx)(i.a,{href:"/docs/release-notes/release-02",children:(0,r.jsx)(i.strong,{children:"release notes"})}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsx)(i.p,{children:"This guide assumes that:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:"You have knowledge of the Amiga OS 1.0 Artichoke API."}),"\n",(0,r.jsx)(i.li,{children:"You have an Amiga Brain running Amiga OS 2.0 Barley."}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"migration-steps",children:"Migration Steps"}),"\n",(0,r.jsx)(i.h3,{id:"update-the-amiga-brain-sdk",children:"Update the Amiga Brain SDK"}),"\n",(0,r.jsx)(i.p,{children:"With the release of Amiga OS 2.0 Barley, we have also released a new version of the Amiga Brain SDK. This new version of the SDK contains the new Amiga OS 2.0 Barley API including new features and breaking changes for the following python packages:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/farm-ng-core/releases/tag/v2.0.0",children:(0,r.jsx)(i.code,{children:"farm_ng_core"})}),"  latest version is ",(0,r.jsx)(i.code,{children:"2.0.0"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/farm-ng-amiga/releases/tag/v2.0.0",children:(0,r.jsx)(i.code,{children:"farm_ng_amiga"})})," latest version is ",(0,r.jsx)(i.code,{children:"2.0.0"})]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"service-api",children:"Service API"}),"\n",(0,r.jsxs)(i.p,{children:["In ",(0,r.jsx)(i.code,{children:"farm-ng-core"})," we have introduced a new service API. This API is used to communicate with the Amiga Brain services. The service API is a framework that allows you to create service clients and service servers and share protobuf messages between them."]}),"\n",(0,r.jsx)(i.p,{children:"In particular, we have introduced the new main classes:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/farm-ng-core/blob/75c13325a156613f6c60b9c517f1ef8b87e8cace/py/farm_ng/core/event_service.py#L67",children:(0,r.jsx)(i.code,{children:"EventServiceGrpc"})})," This class is used to publish events to the Amiga Brain network."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/farm-ng-core/blob/75c13325a156613f6c60b9c517f1ef8b87e8cace/py/farm_ng/core/event_client.py#L66",children:(0,r.jsx)(i.code,{children:"EventClient"})})," This class is used to subscribe to events from the Amiga Brain network."]}),"\n"]}),"\n",(0,r.jsx)(i.p,{children:"We recommend to visit the following tutorials to learn more about the new service API:"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/examples/service_client",children:(0,r.jsx)(i.strong,{children:"Service Client"})}),": This tutorial will show you how to create a service client to communicate with the Amiga Brain services."]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/examples/service_counter",children:(0,r.jsx)(i.strong,{children:"Service Counter"})}),": A bit more advanced tutorial that will show you how to create a service client to create a service that counts the number of times it has been called."]}),"\n"]}),"\n",(0,r.jsx)(i.h3,{id:"example-kivy-camera-streamer-api",children:"Example: Kivy camera streamer api"}),"\n",(0,r.jsxs)(i.p,{children:["In this example we will show you how to migrate the ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy",children:(0,r.jsx)(i.strong,{children:"Kivy camera streamer"})})," example using the new service API."]}),"\n",(0,r.jsx)(i.h4,{id:"update-the-package",children:"Update the package"}),"\n",(0,r.jsxs)(i.p,{children:["In order to use the new application within the brain, we have to include\nthe ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/install.sh",children:(0,r.jsx)(i.code,{children:"install.sh"})}),", ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/main/uninstall.sh",children:(0,r.jsx)(i.code,{children:"uninstall.sh"})})," and ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/main/manifest.json",children:(0,r.jsx)(i.code,{children:"manifest.json"})})," files in the root of the package."]}),"\n",(0,r.jsxs)(i.p,{children:["We suggest to follow the ",(0,r.jsx)(i.a,{href:"/docs/brain/brain-apps-kivy",children:(0,r.jsx)(i.strong,{children:"Amiga Brain SDK"})})," guide to learn more about how to create a package for the Amiga Brain."]}),"\n",(0,r.jsx)(i.h4,{id:"update-the-dependencies",children:"Update the dependencies"}),"\n",(0,r.jsxs)(i.p,{children:["As mentioned before, we have to update the dependencies to use the new version of the ",(0,r.jsx)(i.code,{children:"farm_ng_core"})," and ",(0,r.jsx)(i.code,{children:"farm_ng_amiga"})," packages:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"pip install -U farm_ng_core farm_ng_amiga\n"})}),"\n",(0,r.jsx)(i.p,{children:"check the version of the packages:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-bash",children:"pip list | grep farm-ng\n# farm-ng-amiga 2.0.0\n# farm-ng-core 2.0.0\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Alternatively, make sure that in the ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/setup.cfg",children:(0,r.jsx)(i.code,{children:"setup.cfg"})}),", the ",(0,r.jsx)(i.code,{children:"farm_ng_core"})," and ",(0,r.jsx)(i.code,{children:"farm_ng_amiga"})," packages are pointing to the latest version:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-ini",children:"install_requires =\n    wheel\n    kivy\n    farm_ng_amiga>=2.0.0\n    farm_ng_core>=2.0.0\n    kornia-rs\n"})}),"\n",(0,r.jsx)(i.h4,{id:"update-the-code",children:"Update the code"}),"\n",(0,r.jsxs)(i.p,{children:["In the ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/src/main.py",children:(0,r.jsx)(i.code,{children:"main.py"})})," file we have to import the new service API:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:"from farm_ng.core.event_client import EventClient\nfrom farm_ng.core.event_service_pb2 import EventServiceConfig\nfrom farm_ng.core.event_service_pb2 import EventServiceConfigList\nfrom farm_ng.core.event_service_pb2 import SubscribeRequest\nfrom farm_ng.core.events_file_reader import proto_from_json_file\nfrom farm_ng.core.uri_pb2 import Uri\n"})}),"\n",(0,r.jsxs)(i.p,{children:["Later, in the implementation of the coroutine ",(0,r.jsx)(i.a,{href:"https://github.com/farm-ng/camera-streamer-kivy/blob/2d701d8e79ca331e1afe0c9838a562a43371e2f4/src/main.py#L85C3-L102C25",children:(0,r.jsx)(i.code,{children:"stream_camera"})}),", we have to create a new ",(0,r.jsx)(i.code,{children:"EventClient"})," to leverage the new ",(0,r.jsx)(i.code,{children:"subscribe"})," API to subscribe to the camera events in an asynchronous fashion."]}),"\n",(0,r.jsxs)(i.p,{children:["Note that we can configure the subscription via the ",(0,r.jsx)(i.code,{children:"SubscribeRequest"})," message. In this case, we are subscribing to the ",(0,r.jsx)(i.code,{children:"/rgb"})," topic and we are requesting to receive every ",(0,r.jsx)(i.code,{children:"n"})," messages."]}),"\n",(0,r.jsxs)(i.p,{children:["The block below should reflect how to use the new ",(0,r.jsx)(i.code,{children:"EventClient"})," API:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-python",children:'  async def stream_camera(\n        self, view_name: Literal["rgb", "disparity", "left", "right"] = "rgb"\n    ) -> None:\n        while self.root is None:\n            await asyncio.sleep(0.01)\n\n        async for _, message in EventClient(self.service_config).subscribe(\n            SubscribeRequest(\n                uri=Uri(path=f"/{view_name}"), every_n=self.stream_every_n\n            ),\n            decode=True,\n        ):\n            try:\n                img = self.image_decoder.decode(message.image_data)\n            except Exception as e:\n                logger.exception(f"Error decoding image: {e}")\n                continue\n'})}),"\n",(0,r.jsx)(i.p,{children:"Once you are done and launch the app, you should see the following:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{src:"https://github.com/farm-ng/amiga-dev-kit/assets/5157099/16ae3485-66c2-4b28-8f44-e8457f235689",alt:"Screenshot from 2023-12-01 17-50-01"})})]})}function d(e={}){const{wrapper:i}={...(0,a.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},1151:(e,i,n)=>{n.d(i,{Z:()=>c,a:()=>t});var r=n(7294);const a={},s=r.createContext(a);function t(e){const i=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),r.createElement(s.Provider,{value:i},e.children)}}}]);