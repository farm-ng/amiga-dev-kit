"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[7470],{1515:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>m});var t=n(7462),i=(n(7294),n(3905));n(1839);const r={id:"camera-client",title:"Camera Client"},o=void 0,s={unversionedId:"examples/camera_client/camera-client",id:"examples/camera_client/camera-client",title:"Camera Client",description:"Before diving into this code, here's a quick heads-up on what you'll need to be familiar with:",source:"@site/docs/examples/camera_client/README.md",sourceDirName:"examples/camera_client",slug:"/examples/camera_client/",permalink:"/docs/examples/camera_client/",draft:!1,editUrl:"https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/examples/camera_client/README.md",tags:[],version:"current",frontMatter:{id:"camera-client",title:"Camera Client"},sidebar:"examples",previous:{title:"File Reader GPS",permalink:"/docs/examples/file_reader_gps/"},next:{title:"Camera Settings",permalink:"/docs/examples/camera_settings/"}},l={},m=[{value:"Link to <code>camera_client/main.py</code>",id:"link-to-camera_clientmainpy",level:3},{value:"1. Install the farm-ng Brain ADK package",id:"1-install-the-farm-ng-brain-adk-package",level:3},{value:"2. Install the example&#39;s dependencies",id:"2-install-the-examples-dependencies",level:3},{value:"3. Execute the Python script",id:"3-execute-the-python-script",level:3},{value:"4. Customize the run",id:"4-customize-the-run",level:3},{value:"5. Code overview",id:"5-code-overview",level:3}],c={toc:m};function p(e){let{components:a,...n}=e;return(0,i.kt)("wrapper",(0,t.Z)({},c,n,{components:a,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"Basic Knowledge Requirements",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Before diving into this code, here's a quick heads-up on what you'll need to be familiar with:"),(0,i.kt)("ol",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Python Programming"),": It's important to have a good grasp of Python, especially with concepts\nlike ",(0,i.kt)("inlineCode",{parentName:"li"},"functions"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"loops"),", and ",(0,i.kt)("inlineCode",{parentName:"li"},"classes"),", since the example utilizes these fundamentals."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Asynchronous Programming with asyncio"),": Familiarity with Python's asyncio for writing concurrent\ncode using the ",(0,i.kt)("inlineCode",{parentName:"li"},"async/await")," syntax."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},"Image Processing with OpenCV"),": Basic knowledge of the OpenCV library for handling and manipulating\nimage data, including functions like ",(0,i.kt)("inlineCode",{parentName:"li"},"imdecode"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"applyColorMap"),", and ",(0,i.kt)("inlineCode",{parentName:"li"},"imshow"),"."),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("strong",{parentName:"li"},(0,i.kt)("a",{parentName:"strong",href:"/docs/concepts/oak_service/"},"farm-ng Oak Service Overview")),":\nThis overview provides a base understanding of the gRPC service the client you create will connect to."))),(0,i.kt)("h3",{id:"link-to-camera_clientmainpy"},(0,i.kt)("a",{parentName:"h3",href:"https://github.com/farm-ng/farm-ng-amiga/blob/main-v2/py/examples/camera_client/main.py"},"Link to ",(0,i.kt)("inlineCode",{parentName:"a"},"camera_client/main.py"))),(0,i.kt)("p",null,"This example operates as a standalone Python script,\nin which an ",(0,i.kt)("inlineCode",{parentName:"p"},"EventClient")," to an Oak camera service running on an Amiga brain is created.\nThe selected stream is displayed in a popup window."),(0,i.kt)("p",null,"To successfully run this example, you must use your local PC, as the example won't\nwork if executed directly from a brain (because of the popup window).\nEnsure that a ",(0,i.kt)("a",{parentName:"p",href:"/docs/brain/"},(0,i.kt)("strong",{parentName:"a"},"farm-ng brain"))," running Oak cameras is active.\nYour local PC should be either connected to the same local network as the brain\nor linked to it through tailscale."),(0,i.kt)("h3",{id:"1-install-the-farm-ng-brain-adk-package"},"1. Install the ",(0,i.kt)("a",{parentName:"h3",href:"/docs/brain/brain-install"},"farm-ng Brain ADK package")),(0,i.kt)("h3",{id:"2-install-the-examples-dependencies"},"2. Install the example's dependencies"),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"It is recommended to also install these dependencies and run the\nexample in the brain ADK virtual environment.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"# assuming you're already in the amiga-dev-kit/ directory\ncd farm-ng-amiga/py/examples/camera_client\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"pip3 install -r requirements.txt\n")),(0,i.kt)("h3",{id:"3-execute-the-python-script"},"3. Execute the Python script"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"python3 main.py --service-config service_config.json\n")),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"By default, the camera ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," is assumed to be ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," (",(0,i.kt)("inlineCode",{parentName:"p"},"service_config.json"),").\nYou should replace ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," with your brain's IP address (e.g.,100.67.32.5) or your amiga's\nname (e.g., ",(0,i.kt)("inlineCode",{parentName:"p"},"element-vegetable")," - only supported if connected via tailscale).")),(0,i.kt)("h3",{id:"4-customize-the-run"},"4. Customize the run"),(0,i.kt)("p",null,"Let's have some fun and stream the camera to your laptop over the\nWifi."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You need to discover the WiFi address of your Amiga Brain using\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"WifiClient")," (coming soon)")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"python3 main.py --help\n\n# usage: amiga-camera-stream [-h] --service-config SERVICE_CONFIG\n#\n# optional arguments:\n#   -h, --help            show this help message and exit\n#   --service-config SERVICE_CONFIG\n#                         The camera config.\n")),(0,i.kt)("p",null,"To customize the run, you need to update the ",(0,i.kt)("inlineCode",{parentName:"p"},"service_config.json"),"\nby modifying the ",(0,i.kt)("inlineCode",{parentName:"p"},"host")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"port")," fields.\nYou can also stream the stereo left or right images or the camera's\ndisparity by changing the ",(0,i.kt)("inlineCode",{parentName:"p"},"path")," field (e.g., /left)."),(0,i.kt)("h3",{id:"5-code-overview"},"5. Code overview"),(0,i.kt)("p",null,"In this example we use the ",(0,i.kt)("inlineCode",{parentName:"p"},"EventClient")," with the ",(0,i.kt)("inlineCode",{parentName:"p"},"subscribe")," method to receive the camera stream."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'async def main(service_config_path: Path) -> None:\n    """Run the camera service client.\n\n    Args:\n        service_config_path (Path): The path to the camera service config.\n    """\n    # create a client to the camera service\n    config: EventServiceConfig = proto_from_json_file(service_config_path, EventServiceConfig())\n\n    # instantiate the image decoder\n    image_decoder = ImageDecoder()\n\n    async for event, message in EventClient(config).subscribe(config.subscriptions[0], decode=True):\n        print(f"Timestamps: {event.timestamps[-2]}")\n        print(f"Meta: {message.meta}")\n        print("###################\\n")\n\n        # cast image data bytes to numpy and decode\n        image = np.from_dlpack(image_decoder.decode(message.image_data))\n\n        # visualize the image\n        cv2.namedWindow("image", cv2.WINDOW_NORMAL)\n        cv2.imshow("image", image)\n        cv2.waitKey(1)\n\n\nif __name__ == "__main__":\n    parser = argparse.ArgumentParser(prog="amiga-camera-stream")\n    parser.add_argument("--service-config", type=Path, required=True, help="The camera config.")\n    args = parser.parse_args()\n\n    asyncio.run(main(args.service_config))\n')),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"We highly recommend to have some basic knowledge about\n",(0,i.kt)("a",{parentName:"p",href:"https://docs.python.org/3/library/asyncio.html"},(0,i.kt)("strong",{parentName:"a"},(0,i.kt)("inlineCode",{parentName:"strong"},"asyncio"))),".")))}p.isMDXComponent=!0}}]);