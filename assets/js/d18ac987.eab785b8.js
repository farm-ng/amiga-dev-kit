"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4735],{453:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));a(1839);const i={id:"ros-bridge",title:"Amiga ROS Bridge"},o="Amiga ROS Bridge",s={unversionedId:"brain/ros-bridge",id:"brain/ros-bridge",title:"Amiga ROS Bridge",description:"This is out-of-date for brains running v2.x Amiga OS software.",source:"@site/docs/brain/ros-bridge.md",sourceDirName:"brain",slug:"/brain/ros-bridge",permalink:"/docs/brain/ros-bridge",draft:!1,editUrl:"https://github.com/farm-ng/amiga-dev-kit/tree/main/website/docs/brain/ros-bridge.md",tags:[],version:"current",frontMatter:{id:"ros-bridge",title:"Amiga ROS Bridge"},sidebar:"examples",previous:{title:"Developing Custom Applications",permalink:"/docs/brain/brain-apps"}},l={},p=[{value:"Link to <code>farm-ng/amiga-ros-bridge</code>",id:"link-to-farm-ngamiga-ros-bridge",level:2},{value:"Overview",id:"overview",level:2},{value:"Usage options",id:"usage-options",level:3},{value:"Topics",id:"topics",level:3},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Gain access to the ROS bridge container",id:"gain-access-to-the-ros-bridge-container",level:3},{value:"Install dependencies",id:"install-dependencies",level:3},{value:"<code>amiga_ros_bridge</code> installation",id:"amiga_ros_bridge-installation",level:3},{value:"Catkin workspace",id:"catkin-workspace",level:4},{value:"Clone this repository",id:"clone-this-repository",level:4},{value:"Source your catkin workspace",id:"source-your-catkin-workspace",level:4},{value:"Compile the package <code>amiga_ros_bridge</code>",id:"compile-the-package-amiga_ros_bridge",level:4},{value:"Run the <code>amiga_ros_bridge</code>",id:"run-the-amiga_ros_bridge",level:2},{value:"Specifying the ROS Master",id:"specifying-the-ros-master",level:3},{value:"ROS bridge on the Amiga",id:"ros-bridge-on-the-amiga",level:3},{value:"ROS bridge on your PC",id:"ros-bridge-on-your-pc",level:3},{value:"ROS bridge with mock server",id:"ros-bridge-with-mock-server",level:3},{value:"Start the mock server",id:"start-the-mock-server",level:4},{value:"Start the ros bridge",id:"start-the-ros-bridge",level:4},{value:"Test the <code>amiga_ros_bridge</code>",id:"test-the-amiga_ros_bridge",level:2},{value:"Control the Amiga",id:"control-the-amiga",level:2},{value:"Experimental Amiga Joystick",id:"experimental-amiga-joystick",level:3},{value:"Stable ROS packages",id:"stable-ros-packages",level:3},{value:"Try the examples",id:"try-the-examples",level:2},{value:"Python",id:"python",level:3},{value:"Rust",id:"rust",level:3},{value:"Use <code>depthai-ros</code> for Oak camera streaming",id:"use-depthai-ros-for-oak-camera-streaming",level:2},{value:"Example <code>depthai-ros</code> usage",id:"example-depthai-ros-usage",level:3},{value:"Terminal 1: ssh into the ros container on your amiga",id:"terminal-1-ssh-into-the-ros-container-on-your-amiga",level:4},{value:"Terminal 2: A PC on the same network",id:"terminal-2-a-pc-on-the-same-network",level:4},{value:"Do you want to know more?",id:"do-you-want-to-know-more",level:2}],m={toc:p};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"amiga-ros-bridge"},"Amiga ROS Bridge"),(0,r.kt)("admonition",{title:"deprecation warning",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This is out-of-date for brains running ",(0,r.kt)("inlineCode",{parentName:"p"},"v2.x")," Amiga OS software.",(0,r.kt)("br",null),"\nThis tutorial only applies to brains running Amiga OS ",(0,r.kt)("inlineCode",{parentName:"p"},"v1.x")," versions.",(0,r.kt)("br",null),"\nPlease check back for an updated tutorial for brains running ",(0,r.kt)("inlineCode",{parentName:"p"},"v2.x")," Amiga OS software.")),(0,r.kt)("h2",{id:"link-to-farm-ngamiga-ros-bridge"},(0,r.kt)("a",{parentName:"h2",href:"https://github.com/farm-ng/amiga-ros-bridge"},"Link to ",(0,r.kt)("inlineCode",{parentName:"a"},"farm-ng/amiga-ros-bridge"))),(0,r.kt)("p",null,"This repository contains a ROS bridge for the Farm-ng Amiga platform written in ",(0,r.kt)("a",{parentName:"p",href:"https://www.rust-lang.org/"},"Rust"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Disclaimer:")," the Amiga stack does not leverage ROS for control,\nbut rather uses a gRPC service for control. This bridge is provided as a convenience\nfor users who wish to use ROS for control. For performance critical applications,\nwe recommend using the gRPC service directly.")),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"The ROS bridge, currently supported for ROS Noetic, interfaces with the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/farm-ng/farm-ng-amiga"},"Amiga gRPC services")," for control with ROS\n",(0,r.kt)("a",{parentName:"p",href:"http://docs.ros.org/en/noetic/api/geometry_msgs/html/msg/Twist.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Twist"))," messages."),(0,r.kt)("p",null,"Using the ROS bridge with the amiga requires an Amiga OS ",(0,r.kt)("inlineCode",{parentName:"p"},">= v1.2.0"),"."),(0,r.kt)("p",null,"The ROS bridge allows you to publish\n",(0,r.kt)("a",{parentName:"p",href:"http://docs.ros.org/en/noetic/api/geometry_msgs/html/msg/Twist.html"},(0,r.kt)("inlineCode",{parentName:"a"},"Twist"))," commands on the\n",(0,r.kt)("inlineCode",{parentName:"p"},"/amiga/cmd_vel")," topic to drive the Amiga and subscribe to\n",(0,r.kt)("a",{parentName:"p",href:"http://docs.ros.org/en/noetic/api/geometry_msgs/html/msg/TwistStamped.html"},(0,r.kt)("inlineCode",{parentName:"a"},"TwistStamped")),"\nmeasured rates on the  ",(0,r.kt)("inlineCode",{parentName:"p"},"/amiga/vel")," topic."),(0,r.kt)("h3",{id:"usage-options"},"Usage options"),(0,r.kt)("p",null,"There are currently 3 methods for using the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge"),":"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Running the ",(0,r.kt)("inlineCode",{parentName:"li"},"amiga_ros_bridge")," (and ROS master) on the Amiga,\nwith other ROS nodes on your PC connected to the Amiga ROS master",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Look for sections tagged as ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]"))))),(0,r.kt)("li",{parentName:"ol"},"Running the ",(0,r.kt)("inlineCode",{parentName:"li"},"amiga_ros_bridge")," (and ROS master) on your PC,\nconnected to the Amiga canbus service over gRPC",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Look for sections tagged as ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 2]"))))),(0,r.kt)("li",{parentName:"ol"},"Running the ",(0,r.kt)("inlineCode",{parentName:"li"},"amiga_ros_bridge")," (and ROS master) on your PC, using the mock server",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Look for sections tagged as ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 3]")))))),(0,r.kt)("h3",{id:"topics"},"Topics"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Control")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Subscribed to by ROS bridge"),(0,r.kt)("li",{parentName:"ul"},"Topic: ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/cmd_vel")),(0,r.kt)("li",{parentName:"ul"},"Format: ",(0,r.kt)("a",{parentName:"li",href:"http://docs.ros.org/en/noetic/api/geometry_msgs/html/msg/Twist.html"},(0,r.kt)("inlineCode",{parentName:"a"},"geometry_msgs/Twist"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("strong",{parentName:"p"},"Measured")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Published by ROS bridge"),(0,r.kt)("li",{parentName:"ul"},"Topic: ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/vel")),(0,r.kt)("li",{parentName:"ul"},"Format: ",(0,r.kt)("a",{parentName:"li",href:"http://docs.ros.org/en/noetic/api/geometry_msgs/html/msg/TwistStamped.html"},(0,r.kt)("inlineCode",{parentName:"a"},"geometry_msgs/TwistStamped")))))),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("h3",{id:"gain-access-to-the-ros-bridge-container"},"Gain access to the ROS bridge container"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]"))),(0,r.kt)("p",null,"If you would like run the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," on the Amiga,\nyou will need to gain access to the ROS bridge docker container."),(0,r.kt)("p",null,"Please contact ",(0,r.kt)("inlineCode",{parentName:"p"},"info@farm-ng.com")," for instructions and credentials."),(0,r.kt)("h3",{id:"install-dependencies"},"Install dependencies"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 2]")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 3]"))),(0,r.kt)("p",null,"To run the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," on your PC, you will need:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://wiki.ros.org/noetic/Installation/Ubuntu"},"ROS Noetic install instructions")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.rust-lang.org/learn/get-started"},"Rust install instructions"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Rust is only needed if you will run the ",(0,r.kt)("inlineCode",{parentName:"li"},"amiga_ros_bridge")," or any Rust examples on your PC.")))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NOTE: Using ROS on your PC means you're either running some flavor of\nLinux or know how to run ROS in a VM on your other OS.")),(0,r.kt)("h3",{id:"amiga_ros_bridge-installation"},(0,r.kt)("inlineCode",{parentName:"h3"},"amiga_ros_bridge")," installation"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 2]")),", ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 3]"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"We hope to soon package a pre-compiled ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," in the ros bridge docker container\ninstalled on your Amiga for running with  ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]")),".\nIn the meantime, you will need to manually install the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," as you would on your PC.")),(0,r.kt)("h4",{id:"catkin-workspace"},"Catkin workspace"),(0,r.kt)("p",null,"Create a catkin workspace, if you don't already have one, following the instructions at\n",(0,r.kt)("a",{parentName:"p",href:"http://wiki.ros.org/catkin/Tutorials/create_a_workspace"},"ROS Tutorials - create_a_workspace"),".\nIf this is a new project, it is recommended to create a new, separate catkin workspace."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The remaining instructions will assume you're using a catkin ws at ",(0,r.kt)("inlineCode",{parentName:"p"},"~/catkin_ws"),".")),(0,r.kt)("h4",{id:"clone-this-repository"},"Clone this repository"),(0,r.kt)("p",null,"Clone the repository and initialize the ",(0,r.kt)("inlineCode",{parentName:"p"},"farm-ng-amiga")," submodule."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~/catkin_ws/src\ngit clone https://github.com/farm-ng/amiga-ros-bridge.git\ncd amiga-ros-bridge\ngit submodule update --init\ncd ~/catkin_ws\n")),(0,r.kt)("h4",{id:"source-your-catkin-workspace"},"Source your catkin workspace"),(0,r.kt)("p",null,"Go to your ROS workspace and source the setup.bash file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~/catkin_ws\nsource ~/catkin_ws/devel/setup.bash\n")),(0,r.kt)("h4",{id:"compile-the-package-amiga_ros_bridge"},"Compile the package ",(0,r.kt)("inlineCode",{parentName:"h4"},"amiga_ros_bridge")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Warning: this may take ~25 minutes on the first install on the Amiga brain.\nIt should be much faster on your PC.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~/catkin_ws\ncatkin_make clean # optionally, clean the workspace\ncatkin_make\n")),(0,r.kt)("h2",{id:"run-the-amiga_ros_bridge"},"Run the ",(0,r.kt)("inlineCode",{parentName:"h2"},"amiga_ros_bridge")),(0,r.kt)("h3",{id:"specifying-the-ros-master"},"Specifying the ROS Master"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NOTE: These instructions cover connecting multiple ROS devices to a single ROS master.\nThis is only relevant if you are running the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," on the Amiga,\nand connecting other ROS nodes running on your PC to the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge"),".")),(0,r.kt)("p",null,"In order to connect to the same ROS Master when running ROS nodes on multiple devices,\nyou must specify all nodes to be on the same ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_MASTER_URI"),", but with their own ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_IP"),"."),(0,r.kt)("p",null,"If you want to connect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"roscore")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," running on your Amiga,\nyou must export the ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_MASTER_URI")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_IP")," before starting a ",(0,r.kt)("inlineCode",{parentName:"p"},"roscore"),"\nand/or before launching or running any node that will connect to that ROS Master.\nThis would be:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<AMIGA_IP>\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<AMIGA_IP>")," corresponds to the IP address seen on the\nbottom right hand corner of your Amiga brain home screen.\nSo this command would become, e.g.:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export ROS_MASTER_URI=http://192.168.1.98:11311\nexport ROS_IP=192.168.1.98\n")),(0,r.kt)("p",null,"Meanwhile, your dev station should be set up to connect to that ROS master."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<DEV_STATION_IP>\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<DEV_STATION_IP>")," corresponds to the IP address on your PC running ROS,\nconnected to the same network as the Amiga."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Hint: ",(0,r.kt)("inlineCode",{parentName:"p"},"<DEV_STATION_IP>")," can be found with ",(0,r.kt)("inlineCode",{parentName:"p"},"ifconfig")," or other basic tools.")),(0,r.kt)("p",null,"So this command would become, e.g.:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"export ROS_MASTER_URI=http://192.168.1.98:11311\nexport ROS_IP=192.168.1.123\n")),(0,r.kt)("p",null,"For more information see:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"http://wiki.ros.org/ROS/Tutorials/MultipleMachines"},"Running ROS across multiple machines")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://answers.ros.org/question/349095/ros-on-multiple-machine-not-working-properly/?answer=398784#post-id-398784"},"Specify ",(0,r.kt)("inlineCode",{parentName:"a"},"ROS_IP")," for running on multiple machines"))),(0,r.kt)("h3",{id:"ros-bridge-on-the-amiga"},"ROS bridge on the Amiga"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]"))),(0,r.kt)("p",null,"The first method is with the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," running on the Amiga,\nand you connecting other ROS nodes running on your computer to the Amiga's\nROS Master."),(0,r.kt)("p",null,"Make sure that the Amiga is connected to the same network as your computer\nand that you know both the IP address of the Amiga and of your PC."),(0,r.kt)("p",null,"Launch the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," on the Amiga by ",(0,r.kt)("inlineCode",{parentName:"p"},"ssh"),"-ing into the ros bridge docker container on the Amiga."),(0,r.kt)("p",null,"Please contact ",(0,r.kt)("inlineCode",{parentName:"p"},"info@farm-ng.com")," for instructions and credentials."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nexport ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<AMIGA_IP>\nroslaunch amiga_ros_bridge amiga_ros_bridge.launch\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<AMIGA_IP>")," corresponds to the IP address seen on the\nbottom right hand corner of your Amiga brain home screen."),(0,r.kt)("h3",{id:"ros-bridge-on-your-pc"},"ROS bridge on your PC"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 2]"))),(0,r.kt)("p",null,"Alternatively, you can run the package in your computer as follows.\nMake sure that the Amiga is connected to the same network as your computer\nand that you know the IP address of the Amiga."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"roslaunch amiga_ros_bridge amiga_ros_bridge.launch host:=<AMIGA_IP>\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<AMIGA_IP>")," corresponds to the IP address seen on the\nbottom right hand corner of your Amiga brain home screen."),(0,r.kt)("h3",{id:"ros-bridge-with-mock-server"},"ROS bridge with mock server"),(0,r.kt)("p",null,"For: ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 3]"))),(0,r.kt)("p",null,"Finally, you can run the package in your computer with a\nmock Amiga canbus server that just echos velocity commands back.\nTo run this, you must first start the mock server in a separate terminal:"),(0,r.kt)("h4",{id:"start-the-mock-server"},"Start the mock server"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Warning: This is experimental and is not guaranteed to work.")),(0,r.kt)("p",null,"This is a stand-in for the actual Amiga gRPC canbus service that echos back the received commands."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"In a separate terminal")),", start the Amiga mock server:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\ncd ~/catkin_ws/src/amiga-ros-bridge/\ncargo run --example amiga-mock-server\n")),(0,r.kt)("h4",{id:"start-the-ros-bridge"},"Start the ros bridge"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nroslaunch amiga_ros_bridge amiga_ros_bridge.launch\n")),(0,r.kt)("h2",{id:"test-the-amiga_ros_bridge"},"Test the ",(0,r.kt)("inlineCode",{parentName:"h2"},"amiga_ros_bridge")),(0,r.kt)("p",null,"Now you will be able to connect to the ROS topics used by the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge"),".\nConfirm this in another terminal on your PC with:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nrostopic list\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NOTE: If running the ",(0,r.kt)("inlineCode",{parentName:"p"},"amiga_ros_bridge")," on the Amiga (as in ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"[Method 1]")),")\nand connecting with ROS over the network,\nmake sure to follow the ",(0,r.kt)("a",{parentName:"p",href:"#specifying-the-ros-master"},"Specifying the ROS Master")," instructions.\nRemember to set your ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_MASTER_URI")," & ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_IP")," before running. E.g.,"),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nexport ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<DEV_STATION_IP>\nrostopic list\n"))),(0,r.kt)("p",null,"And you should see:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"/amiga/cmd_vel\n/amiga/vel\n/rosout\n/rosout_agg\n")),(0,r.kt)("h2",{id:"control-the-amiga"},"Control the Amiga"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NOTE: If controlling the robot with a ROS connection over the network,\nmake sure to follow the ",(0,r.kt)("a",{parentName:"p",href:"#specifying-the-ros-master"},"Specifying the ROS Master")," instructions.")),(0,r.kt)("h3",{id:"experimental-amiga-joystick"},"Experimental Amiga Joystick"),(0,r.kt)("p",null,"You can start the ",(0,r.kt)("strong",{parentName:"p"},"experimental")," amiga-joystick app to command velocities\nto the Amiga (e.g. the mock server) and print received velocity states:"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Warning: This is not stable and may require multiple attempts at launching for this to come up.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\ncd ~/catkin_ws/src/amiga-ros-bridge/\ncargo run --example amiga-joystick\n")),(0,r.kt)("p",null,"Use arrow keys (left, right, up, down) to command velocities to the Amiga."),(0,r.kt)("h3",{id:"stable-ros-packages"},"Stable ROS packages"),(0,r.kt)("p",null,"You can publish ",(0,r.kt)("inlineCode",{parentName:"p"},"Twist")," commands to the ROS bridge on the ",(0,r.kt)("inlineCode",{parentName:"p"},"/amiga/cmd_vel")," topic with the\n",(0,r.kt)("a",{parentName:"p",href:"http://wiki.ros.org/rqt_robot_steering"},(0,r.kt)("inlineCode",{parentName:"a"},"rqt_robot_steering"))," package."),(0,r.kt)("p",null,"Install ",(0,r.kt)("inlineCode",{parentName:"p"},"rqt_robot_steering"),", if needed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"apt-get install ros-noetic-rqt-robot-steering\n")),(0,r.kt)("p",null,"Run from your terminal:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nrosrun rqt_robot_steering rqt_robot_steering\n# Then change the topic to `/amiga/cmd_vel`\n")),(0,r.kt)("p",null,"You can subscribe to measured ",(0,r.kt)("inlineCode",{parentName:"p"},"TwistStamped")," states of the amiga with ROS command line tools."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/catkin_ws/devel/setup.bash\nrostopic echo /amiga/vel\n")),(0,r.kt)("h2",{id:"try-the-examples"},"Try the examples"),(0,r.kt)("p",null,"We have provided some examples to help you get started. You will find the examples in the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples"},(0,r.kt)("inlineCode",{parentName:"a"},"examples"))," directory."),(0,r.kt)("h3",{id:"python"},"Python"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples/amiga_cmd_vel_publisher.py"},(0,r.kt)("inlineCode",{parentName:"a"},"amiga_cmd_vel_publisher.py")),":\nPublishes a ",(0,r.kt)("inlineCode",{parentName:"li"},"TwistStamped")," message on the ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/cmd_vel")," topic."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples/amiga_vel_subscriber.py"},(0,r.kt)("inlineCode",{parentName:"a"},"amiga_vel_subscriber.py")),":\nSubscribes to the ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/vel")," topic and prints the received ",(0,r.kt)("inlineCode",{parentName:"li"},"TwistStamped")," messages.")),(0,r.kt)("h3",{id:"rust"},"Rust"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples/amiga_cmd_vel_publisher.rs"},(0,r.kt)("inlineCode",{parentName:"a"},"amiga_cmd_vel_publisher.rs")),":\nPublishes a ",(0,r.kt)("inlineCode",{parentName:"li"},"TwistStamped")," message on the ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/cmd_vel")," topic."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples/amiga_vel_subscriber.rs"},(0,r.kt)("inlineCode",{parentName:"a"},"amiga_vel_subscriber.rs")),":\nSubscribes to the ",(0,r.kt)("inlineCode",{parentName:"li"},"/amiga/vel")," topic and prints the received ",(0,r.kt)("inlineCode",{parentName:"li"},"TwistStamped")," messages."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/farm-ng/amiga-ros-bridge/tree/main/examples/amiga-joystick.rs"},(0,r.kt)("inlineCode",{parentName:"a"},"amiga-joystick.rs")),":\nA simple joystick to command velocities to the Amiga and print received velocity states.")),(0,r.kt)("h2",{id:"use-depthai-ros-for-oak-camera-streaming"},"Use ",(0,r.kt)("inlineCode",{parentName:"h2"},"depthai-ros")," for Oak camera streaming"),(0,r.kt)("p",null,"As of March 29, 2023 - the ROS docker container for the Amiga has a built in installation of ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luxonis/depthai-ros"},(0,r.kt)("inlineCode",{parentName:"a"},"depthai-ros")),".\nThis is installed as the ",(0,r.kt)("inlineCode",{parentName:"p"},"ros-noetic-depthai-ros")," apt package."),(0,r.kt)("p",null,"You can install the March 29, 2023 ROS docker container for the Amiga with the same command\nyou used to install the original ROS docker container for the Amiga."),(0,r.kt)("p",null,"Please refer to ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luxonis/depthai-ros"},(0,r.kt)("inlineCode",{parentName:"a"},"depthai-ros"))," on full usage of their ROS package."),(0,r.kt)("p",null,"As of March 29, 2023 - there is no support for visualization in the ROS docker container for the Amiga.\nThis means you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"depthai-ros")," library to connect to the Oak cameras on your amiga,\nuse other ROS nodes running on the Amiga for image processing,\nbut you will need to stream them over a network to a PC to visualize them.\nThis is done by properly setting ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_MASTER_URI")," & ",(0,r.kt)("inlineCode",{parentName:"p"},"ROS_IP")," on all devices, as explained in\n",(0,r.kt)("a",{parentName:"p",href:"#specifying-the-ros-master"},"Specifying the ROS Master"),"."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"NOTE: You must stop the oak camera service(s) in your apps launcher setting page so the\n",(0,r.kt)("inlineCode",{parentName:"p"},"depthai-ros")," package can access the Oak camera device(s)."),(0,r.kt)("img",{src:"https://user-images.githubusercontent.com/53625197/228701415-89fb6d36-dce5-4b42-808d-2dd486db91a5.png",width:"35%"})),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Tips:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"We provide a quick example of using the ",(0,r.kt)("inlineCode",{parentName:"li"},"depthai-ros")," to stream images below"),(0,r.kt)("li",{parentName:"ul"},"It is up to you to read their docs to decide which of their\nlaunch files / nodes / examples you want to use"),(0,r.kt)("li",{parentName:"ul"},"It is up to you to read their docs to configure / interact with the cameras how you want. E.g.,",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Specify ",(0,r.kt)("inlineCode",{parentName:"li"},"MxId")," of the camera you want to stream"),(0,r.kt)("li",{parentName:"ul"},"Configure for PoE cameras to reduce expected throughput compared to USB (See: ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/luxonis/depthai-ros#poe-cameras"},"https://github.com/luxonis/depthai-ros#poe-cameras"),")"),(0,r.kt)("li",{parentName:"ul"},"Get camera calibrations"),(0,r.kt)("li",{parentName:"ul"},"Pass a Neural Network to run on the Oak"),(0,r.kt)("li",{parentName:"ul"},"Etc.")))),(0,r.kt)("h3",{id:"example-depthai-ros-usage"},"Example ",(0,r.kt)("inlineCode",{parentName:"h3"},"depthai-ros")," usage"),(0,r.kt)("h4",{id:"terminal-1-ssh-into-the-ros-container-on-your-amiga"},"Terminal 1: ssh into the ros container on your amiga"),(0,r.kt)("p",null,"Use an example from ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/luxonis/depthai-ros"},(0,r.kt)("inlineCode",{parentName:"a"},"depthai-ros"))," to stream an oak device."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source /opt/ros/noetic/setup.bash # Or source your catkin_ws\nexport ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<AMIGA_IP>\nroslaunch depthai_examples stereo_inertial_node.launch\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<AMIGA_IP>")," corresponds to the IP address seen on the\nbottom right hand corner of your Amiga brain home screen."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"You will see an error that rviz cannot be launched because there is no support for visualization\nin this docker container.\nBut, if the Oak camera is available, the ",(0,r.kt)("inlineCode",{parentName:"p"},"depthai-ros")," node will start and a camera will be streaming."),(0,r.kt)("pre",{parentName:"blockquote"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ERROR: cannot launch node of type [rviz/rviz]: rviz\nROS path [0]=/opt/ros/noetic/share/ros\nROS path [1]=/data/home/ros/catkin_ws/src\nROS path [2]=/opt/ros/noetic/share\n"))),(0,r.kt)("h4",{id:"terminal-2-a-pc-on-the-same-network"},"Terminal 2: A PC on the same network"),(0,r.kt)("p",null,"Watch the the stream from a computer on the same network."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source /opt/ros/noetic/setup.bash # Or source your catkin_ws\nexport ROS_MASTER_URI=http://<AMIGA_IP>:11311\nexport ROS_IP=<DEV_STATION_IP>\nrqt_image_view\n")),(0,r.kt)("p",null,"Where ",(0,r.kt)("inlineCode",{parentName:"p"},"<AMIGA_IP>")," corresponds to the IP address seen on the\nbottom right hand corner of your Amiga brain home screen.\nAnd ",(0,r.kt)("inlineCode",{parentName:"p"},"<DEV_STATION_IP>")," corresponds to the IP address on your PC running ROS,\nconnected to the same network as the Amiga."),(0,r.kt)("p",null,"Now select the image you want to view based on topic,\ne.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"/stereo_inertial_publisher/color/image")," or  ",(0,r.kt)("inlineCode",{parentName:"p"},"/stereo_inertial_publisher/stereo/depth"),"."),(0,r.kt)("img",{src:"https://user-images.githubusercontent.com/53625197/228702256-d5ef02d9-98a6-476d-b636-56f66f84822d.png",width:"50%"}),(0,r.kt)("h2",{id:"do-you-want-to-know-more"},"Do you want to know more?"),(0,r.kt)("p",null,"Inspect ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/farm-ng/amiga-ros-bridge/blob/main/ci_test.sh"},(0,r.kt)("inlineCode",{parentName:"a"},"ci_test.sh")),"\nfor a full example of how to run the bridge in a CI environment."))}d.isMDXComponent=!0}}]);